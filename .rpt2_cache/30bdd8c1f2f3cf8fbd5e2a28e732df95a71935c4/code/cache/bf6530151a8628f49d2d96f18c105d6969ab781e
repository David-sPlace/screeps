{"code":"import * as tslib_1 from \"tslib\";\r\nimport { CreepTask } from \"tasks/CreepTask\";\r\nimport { CreepTaskRequest } from \"tasks/CreepTaskRequest\";\r\nimport { CreepTaskQueue } from \"../CreepTaskQueue\";\r\nimport * as utils from \"utils/utils\";\r\nvar RestockRequest = /** @class */ (function (_super) {\r\n    tslib_1.__extends(RestockRequest, _super);\r\n    function RestockRequest(roomName, restockID) {\r\n        var _this = _super.call(this, roomName, \"\\uD83D\\uDED2\", restockID) || this;\r\n        _this.priority = 0;\r\n        _this.name = \"Restock\";\r\n        _this.requiredRole = 3 /* ROLE_WORKER */;\r\n        _this.maxConcurrentCount = 2;\r\n        return _this;\r\n    }\r\n    return RestockRequest;\r\n}(CreepTaskRequest));\r\nexport { RestockRequest };\r\nvar Restock = /** @class */ (function (_super) {\r\n    tslib_1.__extends(Restock, _super);\r\n    function Restock(taskInfo) {\r\n        return _super.call(this, taskInfo) || this;\r\n    }\r\n    Restock.prototype.doWork = function () {\r\n        var creep = Game.creeps[this.request.assignedTo];\r\n        var targets = creep.room.find(FIND_STRUCTURES, {\r\n            filter: function (structure) {\r\n                return (structure.structureType == STRUCTURE_EXTENSION || structure.structureType == STRUCTURE_SPAWN) &&\r\n                    structure.energy < structure.energyCapacity;\r\n            }\r\n        }).sort(function (structureA, structureB) { return creep.pos.getRangeTo(structureA) - creep.pos.getRangeTo(structureB); });\r\n        if (creep.carry.energy == 0 || targets.length == 0) {\r\n            this.request.finished = true;\r\n            return;\r\n        }\r\n        if (creep.transfer(targets[0], RESOURCE_ENERGY) == ERR_NOT_IN_RANGE) {\r\n            creep.moveTo(targets[0], { visualizePathStyle: { stroke: '#ffffff' } });\r\n        }\r\n    };\r\n    Restock.addTasks = function (roomName) {\r\n        var restockables = utils.getRestockables(roomName);\r\n        for (var targetID in restockables) {\r\n            var restockable = restockables[targetID];\r\n            var request = new RestockRequest(roomName, restockable.id);\r\n            var existingTaskCount = CreepTaskQueue.totalCount(roomName, request.name);\r\n            var maxConcurrentCount = request.maxConcurrentCount;\r\n            if (existingTaskCount < maxConcurrentCount) {\r\n                CreepTaskQueue.addPending(request);\r\n            }\r\n        }\r\n    };\r\n    return Restock;\r\n}(CreepTask));\r\nexport { Restock };\r\n//# sourceMappingURL=Restock.js.map","map":{"version":3,"file":"Restock.js","sourceRoot":"","sources":["../../src/tasks/creep/Restock.ts"],"names":[],"mappings":";AAAA,OAAO,EAAE,SAAS,EAAE,MAAM,iBAAiB,CAAC;AAC5C,OAAO,EAAE,gBAAgB,EAAE,MAAM,wBAAwB,CAAC;AAC1D,OAAO,EAAE,cAAc,EAAE,MAAM,mBAAmB,CAAC;AACnD,OAAO,KAAK,KAAK,MAAM,aAAa,CAAA;AAGpC;IAAoC,0CAAgB;IAMnD,wBAAY,QAAgB,EAAE,SAAiB;QAA/C,YAEC,kBAAM,QAAQ,EAAE,cAAI,EAAE,SAAS,CAAC,SAChC;QAPD,cAAQ,GAAW,CAAC,CAAC;QACrB,UAAI,GAAG,SAAS,CAAC;QACjB,kBAAY,uBAAwB;QACpC,wBAAkB,GAAG,CAAC,CAAC;;IAIvB,CAAC;IACF,qBAAC;AAAD,CAAC,AAVD,CAAoC,gBAAgB,GAUnD;;AAED;IAA6B,mCAAS;IAErC,iBAAY,QAA0B;eAErC,kBAAM,QAAQ,CAAC;IAChB,CAAC;IAED,wBAAM,GAAN;QAEC,IAAI,KAAK,GAAG,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,OAAO,CAAC,UAAU,CAAU,CAAC;QAC1D,IAAI,OAAO,GAAG,KAAK,CAAC,IAAI,CAAC,IAAI,CAAC,eAAe,EAAE;YAC9C,MAAM,EAAE,UAAC,SAAS;gBAEjB,OAAO,CAAC,SAAS,CAAC,aAAa,IAAI,mBAAmB,IAAI,SAAS,CAAC,aAAa,IAAI,eAAe,CAAC;oBACpG,SAAS,CAAC,MAAM,GAAG,SAAS,CAAC,cAAc,CAAC;YAC9C,CAAC;SACD,CAAC,CAAC,IAAI,CAAC,UAAC,UAAU,EAAE,UAAU,IAAK,OAAA,KAAK,CAAC,GAAG,CAAC,UAAU,CAAC,UAAU,CAAC,GAAG,KAAK,CAAC,GAAG,CAAC,UAAU,CAAC,UAAU,CAAC,EAAnE,CAAmE,CAAC,CAAC;QACzG,IAAI,KAAK,CAAC,KAAK,CAAC,MAAM,IAAI,CAAC,IAAI,OAAO,CAAC,MAAM,IAAI,CAAC,EAClD;YACC,IAAI,CAAC,OAAO,CAAC,QAAQ,GAAG,IAAI,CAAC;YAC7B,OAAO;SACP;QACD,IAAI,KAAK,CAAC,QAAQ,CAAC,OAAO,CAAC,CAAC,CAAC,EAAE,eAAe,CAAC,IAAI,gBAAgB,EACnE;YACC,KAAK,CAAC,MAAM,CAAC,OAAO,CAAC,CAAC,CAAC,EAAE,EAAE,kBAAkB,EAAE,EAAE,MAAM,EAAE,SAAS,EAAE,EAAE,CAAC,CAAC;SACxE;IAEF,CAAC;IACM,gBAAQ,GAAf,UAAgB,QAAgB;QAE/B,IAAI,YAAY,GAAG,KAAK,CAAC,eAAe,CAAC,QAAQ,CAAC,CAAA;QAElD,KAAK,IAAM,QAAQ,IAAI,YAAY,EACnC;YACC,IAAI,WAAW,GAAG,YAAY,CAAC,QAAQ,CAAC,CAAC;YACzC,IAAI,OAAO,GAAG,IAAI,cAAc,CAAC,QAAQ,EAAE,WAAW,CAAC,EAAE,CAAC,CAAC;YAC3D,IAAI,iBAAiB,GAAG,cAAc,CAAC,UAAU,CAAC,QAAQ,EAAE,OAAO,CAAC,IAAI,CAAC,CAAC;YAC1E,IAAI,kBAAkB,GAAG,OAAO,CAAC,kBAAkB,CAAC;YAEpD,IAAI,iBAAiB,GAAG,kBAAkB,EAC1C;gBACC,cAAc,CAAC,UAAU,CAAC,OAAO,CAAC,CAAA;aAClC;SACD;IACF,CAAC;IACF,cAAC;AAAD,CAAC,AA7CD,CAA6B,SAAS,GA6CrC"}}
