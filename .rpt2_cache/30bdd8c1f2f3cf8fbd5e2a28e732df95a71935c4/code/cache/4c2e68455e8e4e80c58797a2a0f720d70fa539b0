{"code":"var CreepTaskQueue = /** @class */ (function () {\r\n    function CreepTaskQueue() {\r\n    }\r\n    CreepTaskQueue.totalCount = function (roomName, taskName) {\r\n        if (taskName === void 0) { taskName = \"\"; }\r\n        return CreepTaskQueue.activeCount(roomName, taskName)\r\n            + CreepTaskQueue.pendingCount(roomName, taskName);\r\n    };\r\n    CreepTaskQueue.pendingCount = function (roomName, taskName) {\r\n        if (taskName === void 0) { taskName = \"\"; }\r\n        var roomMem = Game.rooms[roomName].memory;\r\n        if (taskName == \"\") {\r\n            return roomMem.pendingWorkerRequests.length;\r\n        }\r\n        else {\r\n            var count = 0;\r\n            var tasks = roomMem.pendingWorkerRequests;\r\n            for (var id in tasks) {\r\n                var task = tasks[id];\r\n                if (task.name == taskName)\r\n                    count++;\r\n            }\r\n            return count;\r\n        }\r\n    };\r\n    CreepTaskQueue.activeCount = function (roomName, taskName) {\r\n        if (taskName === void 0) { taskName = \"\"; }\r\n        var roomMem = Game.rooms[roomName].memory;\r\n        if (taskName == \"\") {\r\n            return roomMem.activeWorkerTaskCount;\r\n        }\r\n        else {\r\n            var count = 0;\r\n            var tasks = roomMem.activeWorkerRequests;\r\n            for (var task in tasks) {\r\n                var test = tasks[task];\r\n                if (test.name == taskName)\r\n                    count++;\r\n            }\r\n            return count;\r\n        }\r\n    };\r\n    CreepTaskQueue.addPending = function (request) {\r\n        var roomMem = Game.rooms[request.roomName].memory;\r\n        roomMem.pendingWorkerRequests.push(request);\r\n    };\r\n    CreepTaskQueue.start = function (creepName, roomName) {\r\n        // console.log(\"start\");\r\n        var roomMem = Game.rooms[roomName].memory;\r\n        if (roomMem.pendingWorkerRequests.length == 0)\r\n            return;\r\n        var creep = Game.creeps[creepName];\r\n        var mem = creep.memory;\r\n        var validTasks = roomMem.pendingWorkerRequests.filter(function (r) { return r.requiredRole == mem.role; }).sort(function (s) { return s.priority; });\r\n        for (var key in validTasks) {\r\n            if (validTasks.hasOwnProperty(key)) {\r\n                var task = validTasks[key];\r\n                //console.log(JSON.stringify(task));\r\n                var index = roomMem.pendingWorkerRequests.indexOf(task);\r\n                //console.log(\"task index: \" + index)\r\n                var nextTask = roomMem.pendingWorkerRequests.splice(index, 1).shift();\r\n                if (nextTask != undefined) {\r\n                    nextTask.assignedTo = creepName;\r\n                    roomMem.activeWorkerRequests[creepName] = nextTask;\r\n                    roomMem.activeWorkerTaskCount++;\r\n                    break;\r\n                }\r\n            }\r\n        }\r\n    };\r\n    CreepTaskQueue.finish = function (creepName, roomName) {\r\n        var roomMem = Game.rooms[roomName].memory;\r\n        //var started = roomMem.activeWorkerRequests[creepName].started;\r\n        //if(started) roomMem.activeWorkerTaskCount--;\r\n        delete roomMem.activeWorkerRequests[creepName];\r\n    };\r\n    CreepTaskQueue.allActive = function (roomName) {\r\n        var roomMem = Game.rooms[roomName].memory;\r\n        return roomMem.activeWorkerRequests;\r\n    };\r\n    CreepTaskQueue.count = function (roomName) {\r\n    };\r\n    return CreepTaskQueue;\r\n}());\r\nexport { CreepTaskQueue };\r\n//# sourceMappingURL=CreepTaskQueue.js.map","map":{"version":3,"file":"CreepTaskQueue.js","sourceRoot":"","sources":["../src/tasks/CreepTaskQueue.ts"],"names":[],"mappings":"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"}}
