{"code":"import * as utils from \"utils/utils\";\r\nimport { RestockTask } from \"tasks/RestockTask\";\r\nimport { BuildTask } from \"tasks/BuildTask\";\r\nimport { UpgradeTask } from \"tasks/UpgradeTask\";\r\nimport { WorkerTaskQueue } from \"utils/TaskQueue\";\r\n// import { ChargeRampartTask, ChargeRampartTaskInfo } from \"tasks/ChargeRampartTask\";\r\nimport { RepairTask } from \"tasks/RepairTask\";\r\nimport { FillTowerTask } from \"tasks/FillTowerTask\";\r\nvar TaskManager = /** @class */ (function () {\r\n    function TaskManager() {\r\n    }\r\n    TaskManager.processRoomTasks = function (roomName) {\r\n        this.addMissingTasks(roomName);\r\n        this.activateTasks(roomName);\r\n    };\r\n    TaskManager.activateTasks = function (roomName) {\r\n        var idleCreeps = utils.findIdleCreeps(roomName);\r\n        for (var id in idleCreeps) {\r\n            var creep = idleCreeps[id];\r\n            if (creep != undefined) {\r\n                var mem = creep.memory;\r\n                if (mem.idle) {\r\n                    WorkerTaskQueue.startNextTask(creep.name, roomName);\r\n                }\r\n            }\r\n        }\r\n        var stillIdleCreeps = utils.findIdleCreeps(roomName);\r\n        for (var id in stillIdleCreeps) {\r\n            var creep = stillIdleCreeps[id];\r\n            var m = creep.memory;\r\n            creep.moveTo(Game.getObjectById(m.spawnID));\r\n        }\r\n        var activeTasks = WorkerTaskQueue.allActiveTasks(roomName);\r\n        // console.log(\"There are now \" + activeTasks + \" active tasks.\")\r\n        for (var assignedName in activeTasks) {\r\n            //console.log(\"Assigned name: \" + assignedName);\r\n            var creep = Game.creeps[assignedName];\r\n            var taskInfo = activeTasks[assignedName];\r\n            if (taskInfo.assignedCreepName != assignedName) {\r\n                // console.log(\"fault detected!\");\r\n                taskInfo.assignedCreepName = assignedName;\r\n            }\r\n            if (taskInfo.name == \"Restock\")\r\n                this.processTask(new RestockTask(taskInfo), roomName);\r\n            else if (taskInfo.name == \"Upgrade\")\r\n                this.processTask(new UpgradeTask(taskInfo), roomName);\r\n            else if (taskInfo.name == \"Build\")\r\n                this.processTask(new BuildTask(taskInfo), roomName);\r\n            else if (taskInfo.name == \"Repair\")\r\n                this.processTask(new RepairTask(taskInfo), roomName);\r\n            else if (taskInfo.name == \"FillTower\")\r\n                this.processTask(new FillTowerTask(taskInfo), roomName);\r\n        }\r\n    };\r\n    TaskManager.processTask = function (task, roomName) {\r\n        //this._workerTasks.loadTasks(roomName);\r\n        if (!task.taskInfo.started) {\r\n            task.start();\r\n        }\r\n        if (task.taskInfo.finished) {\r\n            task.finish();\r\n            WorkerTaskQueue.finishTask(task.taskInfo.assignedCreepName, roomName);\r\n        }\r\n        if (task.taskInfo.started) {\r\n            task.continue();\r\n            if (task.taskInfo.finished) {\r\n                task.finish();\r\n                WorkerTaskQueue.finishTask(task.taskInfo.assignedCreepName, roomName);\r\n            }\r\n        }\r\n    };\r\n    TaskManager.addMissingTasks = function (roomName) {\r\n        RestockTask.addRestockTasks(roomName);\r\n        UpgradeTask.addUpgradeTasks(roomName);\r\n        //ChargeRampartTask.addRepairTask(roomName);\r\n        FillTowerTask.addRepairTask(roomName);\r\n        //BuildTask.addBuildTasks(roomName);\r\n        RepairTask.addRepairTask(roomName);\r\n    };\r\n    return TaskManager;\r\n}());\r\nexport { TaskManager };\r\n//# sourceMappingURL=taskManager.js.map","map":{"version":3,"file":"taskManager.js","sourceRoot":"","sources":["src/taskManager.ts"],"names":[],"mappings":"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"}}
