{"code":"import { RoomManager } from \"RoomManager\";\r\nvar WorkerTask = /** @class */ (function () {\r\n    function WorkerTask(roomName) {\r\n        this.started = false;\r\n        this.finished = false;\r\n        this.assignedCreepName = \"\";\r\n        this.roomName = roomName;\r\n    }\r\n    WorkerTask.prototype.start = function (creepID, context) {\r\n        //console.log(`${creepID} is starting task ${this.name}`)\r\n        var creep = Game.getObjectById(creepID);\r\n        var creepMem = creep.memory;\r\n        this.assignedCreepName = creep.name;\r\n        creepMem.currentTask = this.name;\r\n        this.started = true;\r\n        creepMem.idle = false;\r\n    };\r\n    WorkerTask.prototype.continue = function (creepID, context) {\r\n        var creep = Game.getObjectById(creepID);\r\n        if (creep === undefined || creep.memory === undefined || this.assignedCreepName == \"\") {\r\n            console.log(\"cant continue, don't have a creep. - completing task.\");\r\n            this.finish(creepID, context);\r\n            return;\r\n        }\r\n        var creepMemory = creep.memory;\r\n        //if creep runs out of energy, it starts prepping.\r\n        if (creep.carry.energy == 0) {\r\n            creepMemory.preppingForTask = true;\r\n        }\r\n        if (creepMemory.preppingForTask) {\r\n            this.collect(this.roomName, creep.id, function () { creepMemory.preppingForTask = false; });\r\n        }\r\n        else {\r\n            this.announce(creepID);\r\n            this.moveoutdaway(creepID);\r\n            this.doWork(creepID, context);\r\n        }\r\n        // else\r\n        // {\r\n        // \tconsole.log(`processing existing task for ${creep.name}`)\r\n        // }\r\n        //console.log(\"found \" + creep.name);\r\n    };\r\n    WorkerTask.prototype.finish = function (creepID, context) {\r\n        var creep = Game.getObjectById(creepID);\r\n        if (creep !== undefined) {\r\n            creep.say(\"ðŸš§Finished!\");\r\n            var mem = creep.memory;\r\n            mem.idle = true;\r\n            mem.preppingForTask = false;\r\n            mem.currentTask = \"\";\r\n        }\r\n        this.finished = true;\r\n        //var timeTaken = Game.time - this.timeRequested\r\n        //console.log(`Time taken for ${this.name}: ${timeTaken}`);\r\n    };\r\n    WorkerTask.prototype.moveoutdaway = function (creepID) {\r\n        var roomMem = Game.rooms[this.roomName].memory;\r\n        var harvestLocs = roomMem.harvestLocations;\r\n        var creep = Game.getObjectById(creepID);\r\n        var creepMem = creep.memory;\r\n        if (creepMem.preppingForTask)\r\n            return;\r\n        for (var id in harvestLocs) {\r\n            var loc = harvestLocs[id];\r\n            if (creep.pos.getRangeTo(loc.pos.x, loc.pos.y) < 1) {\r\n                //creep.say(\"moving!\")\r\n                creep.moveTo(Game.getObjectById(creepMem.spawnID));\r\n            }\r\n        }\r\n    };\r\n    WorkerTask.prototype.announce = function (creepID) {\r\n        if (Game.time % 10 == 0) {\r\n            var creep = Game.getObjectById(creepID);\r\n            creep.say(this.wingDing);\r\n        }\r\n    };\r\n    WorkerTask.prototype.collect = function (roomName, creepID, energyFullCallback) {\r\n        var creep = Game.getObjectById(creepID);\r\n        var closestSpot = RoomManager.GetClosestOrAssignedHarvestLocation(roomName, creepID);\r\n        if (creep.carry.energy < creep.carryCapacity) {\r\n            if (Game.time % 5 == 0) {\r\n                creep.say(\"\\uD83D\\uDD04\" + this.wingDing);\r\n            }\r\n            if (creep.carry.energy == 0) {\r\n            }\r\n            if (closestSpot != undefined) {\r\n                var source = Game.getObjectById(closestSpot.sourceID);\r\n                if (creep.pos.getRangeTo(closestSpot.pos.x, closestSpot.pos.y) > 0) {\r\n                    //console.log(\"moving\");\r\n                    //creep.memory.moving = true;\r\n                    creep.moveTo(closestSpot.pos.x, closestSpot.pos.y, { visualizePathStyle: { stroke: '#ffaa00' } });\r\n                }\r\n                else {\r\n                    creep.harvest(source);\r\n                }\r\n            }\r\n            else {\r\n                creep.say(\"\\u231B\");\r\n                var mem = creep.memory;\r\n                var home = Game.getObjectById(mem.spawnID);\r\n                creep.moveTo(home.pos.x, home.pos.y);\r\n            }\r\n        }\r\n        else {\r\n            //console.log (closestSpot.assignedTo + \" has been unassigned.\")\r\n            closestSpot.assignedTo = null;\r\n            energyFullCallback();\r\n        }\r\n    };\r\n    return WorkerTask;\r\n}());\r\nexport { WorkerTask };\r\n//# sourceMappingURL=WorkerTask.js.map","map":{"version":3,"file":"WorkerTask.js","sourceRoot":"","sources":["../src/abstract/WorkerTask.ts"],"names":[],"mappings":"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"}}
