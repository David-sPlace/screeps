{"code":"import * as utils from \"utils/utils\";\r\nimport { Restock } from \"tasks/creep/Restock\";\r\nimport { Build } from \"tasks/creep/Build\";\r\nimport { Upgrade } from \"tasks/creep/Upgrade\";\r\nimport { CreepTaskQueue } from \"tasks/CreepTaskQueue\";\r\nimport { StructureTaskQueue } from \"tasks/StructureTaskQueue\";\r\nimport { RepairTask } from \"tasks/creep/Repair\";\r\nimport { FillTower } from \"tasks/creep/FillTower\";\r\nimport { TowerRepair } from \"tasks/structure/TowerRepair\";\r\nimport { TowerAttack } from \"tasks/structure/TowerAttack\";\r\nvar TaskManager = /** @class */ (function () {\r\n    function TaskManager() {\r\n    }\r\n    TaskManager.continueActiveRequests = function (roomName) {\r\n        var activeWorkerTasks = CreepTaskQueue.allActive(roomName);\r\n        for (var assignedName in activeWorkerTasks) {\r\n            var taskInfo = activeWorkerTasks[assignedName];\r\n            if (taskInfo.assignedTo != assignedName)\r\n                taskInfo.assignedTo = assignedName;\r\n            if (taskInfo.name == \"Restock\")\r\n                this.processTask(new Restock(taskInfo), roomName);\r\n            else if (taskInfo.name == \"Upgrade\")\r\n                this.processTask(new Upgrade(taskInfo), roomName);\r\n            else if (taskInfo.name == \"Build\")\r\n                this.processTask(new Build(taskInfo), roomName);\r\n            else if (taskInfo.name == \"Repair\")\r\n                this.processTask(new RepairTask(taskInfo), roomName);\r\n            else if (taskInfo.name == \"FillTower\")\r\n                this.processTask(new FillTower(taskInfo), roomName);\r\n        }\r\n        var activeStructureTasks = StructureTaskQueue.allActive(roomName);\r\n        for (var buildingID in activeStructureTasks) {\r\n            var structureTaskInfo = activeStructureTasks[buildingID];\r\n            if (structureTaskInfo.assignedTo != buildingID)\r\n                structureTaskInfo.assignedTo = buildingID;\r\n            if (structureTaskInfo.name == \"TowerRepair\")\r\n                this.processTask(new TowerRepair(structureTaskInfo), roomName);\r\n            if (structureTaskInfo.name == \"TowerAttack\")\r\n                this.processTask(new TowerAttack(structureTaskInfo), roomName);\r\n        }\r\n    };\r\n    TaskManager.processRoomTasks = function (roomName) {\r\n        this.addBuildingTasks(roomName);\r\n        this.addWorkerTasks(roomName);\r\n        this.assignPendingRequests(roomName);\r\n        this.continueActiveRequests(roomName);\r\n    };\r\n    TaskManager.assignPendingRequests = function (roomName) {\r\n        var idleCreeps = utils.findIdleCreeps(roomName);\r\n        for (var id in idleCreeps) {\r\n            var creep = idleCreeps[id];\r\n            if (creep != undefined) {\r\n                var mem = creep.memory;\r\n                if (mem.idle) {\r\n                    CreepTaskQueue.start(creep.name, roomName);\r\n                }\r\n            }\r\n        }\r\n        var idleStructures = utils.findIdleSmartStructures(roomName);\r\n        for (var id in idleStructures) {\r\n            var structure = idleStructures[id];\r\n            if (structure != undefined) {\r\n                var memory = structure.memory;\r\n                if (memory.idle) {\r\n                    StructureTaskQueue.startTask(structure.id, roomName);\r\n                }\r\n            }\r\n        }\r\n        var stillIdleCreeps = utils.findIdleCreeps(roomName);\r\n        for (var id in stillIdleCreeps) {\r\n            var creep = stillIdleCreeps[id];\r\n            var m = creep.memory;\r\n            creep.moveTo(Game.getObjectById(m.spawnID));\r\n        }\r\n    };\r\n    TaskManager.processTask = function (task, roomName) {\r\n        if (!task.request.started) {\r\n            task.start();\r\n        }\r\n        if (task.request.finished) {\r\n            task.finish();\r\n            CreepTaskQueue.finish(task.request.assignedTo, roomName);\r\n        }\r\n        if (task.request.started) {\r\n            task.continue();\r\n            if (task.request.finished) {\r\n                task.finish();\r\n                CreepTaskQueue.finish(task.request.assignedTo, roomName);\r\n            }\r\n        }\r\n    };\r\n    TaskManager.addBuildingTasks = function (roomName) {\r\n        TowerAttack.addTask(roomName);\r\n        TowerRepair.addTask(roomName);\r\n    };\r\n    TaskManager.addWorkerTasks = function (roomName) {\r\n        Restock.addTasks(roomName);\r\n        FillTower.addTasks(roomName);\r\n        Build.addTasks(roomName);\r\n        Upgrade.addTasks(roomName);\r\n    };\r\n    return TaskManager;\r\n}());\r\nexport { TaskManager };\r\n//# sourceMappingURL=taskManager.js.map","map":{"version":3,"file":"taskManager.js","sourceRoot":"","sources":["src/taskManager.ts"],"names":[],"mappings":"AACA,OAAO,KAAK,KAAK,MAAM,aAAa,CAAC;AACrC,OAAO,EAAE,OAAO,EAAE,MAAM,qBAAqB,CAAC;AAC9C,OAAO,EAAE,KAAK,EAAE,MAAM,mBAAmB,CAAC;AAC1C,OAAO,EAAE,OAAO,EAAE,MAAM,qBAAqB,CAAC;AAC9C,OAAO,EAAE,cAAc,EAAE,MAAM,sBAAsB,CAAC;AACtD,OAAO,EAAE,kBAAkB,EAAE,MAAM,0BAA0B,CAAC;AAE9D,OAAO,EAAE,UAAU,EAAE,MAAM,oBAAoB,CAAC;AAChD,OAAO,EAAE,SAAS,EAAE,MAAM,uBAAuB,CAAC;AAClD,OAAO,EAAE,WAAW,EAAE,MAAM,6BAA6B,CAAC;AAC1D,OAAO,EAAE,WAAW,EAAE,MAAM,6BAA6B,CAAC;AAE1D;IAAA;IAqHA,CAAC;IAnHO,kCAAsB,GAA7B,UAA8B,QAAgB;QAE7C,IAAI,iBAAiB,GAAG,cAAc,CAAC,SAAS,CAAC,QAAQ,CAAC,CAAC;QAC3D,KAAK,IAAI,YAAY,IAAI,iBAAiB,EAC1C;YACC,IAAI,QAAQ,GAAG,iBAAiB,CAAC,YAAY,CAAC,CAAC;YAC/C,IAAI,QAAQ,CAAC,UAAU,IAAI,YAAY;gBAAE,QAAQ,CAAC,UAAU,GAAG,YAAY,CAAC;YAE5E,IAAI,QAAQ,CAAC,IAAI,IAAI,SAAS;gBAC7B,IAAI,CAAC,WAAW,CAAC,IAAI,OAAO,CAAC,QAAQ,CAAC,EAAE,QAAQ,CAAC,CAAC;iBAC9C,IAAI,QAAQ,CAAC,IAAI,IAAI,SAAS;gBAClC,IAAI,CAAC,WAAW,CAAC,IAAI,OAAO,CAAC,QAAQ,CAAC,EAAE,QAAQ,CAAC,CAAC;iBAC9C,IAAI,QAAQ,CAAC,IAAI,IAAI,OAAO;gBAChC,IAAI,CAAC,WAAW,CAAC,IAAI,KAAK,CAAC,QAAQ,CAAC,EAAE,QAAQ,CAAC,CAAC;iBAC5C,IAAI,QAAQ,CAAC,IAAI,IAAI,QAAQ;gBACjC,IAAI,CAAC,WAAW,CAAC,IAAI,UAAU,CAAC,QAAQ,CAAC,EAAE,QAAQ,CAAC,CAAC;iBACjD,IAAI,QAAQ,CAAC,IAAI,IAAI,WAAW;gBACpC,IAAI,CAAC,WAAW,CAAC,IAAI,SAAS,CAAC,QAAQ,CAAC,EAAE,QAAQ,CAAC,CAAC;SAErD;QAED,IAAI,oBAAoB,GAAG,kBAAkB,CAAC,SAAS,CAAC,QAAQ,CAAC,CAAC;QAClE,KAAK,IAAI,UAAU,IAAI,oBAAoB,EAC3C;YACC,IAAI,iBAAiB,GAAG,oBAAoB,CAAC,UAAU,CAAC,CAAC;YACzD,IAAI,iBAAiB,CAAC,UAAU,IAAI,UAAU;gBAAE,iBAAiB,CAAC,UAAU,GAAG,UAAU,CAAC;YAE1F,IAAI,iBAAiB,CAAC,IAAI,IAAI,aAAa;gBAC1C,IAAI,CAAC,WAAW,CAAC,IAAI,WAAW,CAAC,iBAAiB,CAAC,EAAE,QAAQ,CAAC,CAAC;YAChE,IAAI,iBAAiB,CAAC,IAAI,IAAI,aAAa;gBAC1C,IAAI,CAAC,WAAW,CAAC,IAAI,WAAW,CAAC,iBAAiB,CAAC,EAAE,QAAQ,CAAC,CAAC;SAChE;IACF,CAAC;IAEM,4BAAgB,GAAvB,UAAwB,QAAgB;QAEvC,IAAI,CAAC,gBAAgB,CAAC,QAAQ,CAAC,CAAC;QAChC,IAAI,CAAC,cAAc,CAAC,QAAQ,CAAC,CAAC;QAC9B,IAAI,CAAC,qBAAqB,CAAC,QAAQ,CAAC,CAAC;QACrC,IAAI,CAAC,sBAAsB,CAAC,QAAQ,CAAC,CAAC;IACvC,CAAC;IAEc,iCAAqB,GAApC,UAAqC,QAAgB;QAEpD,IAAI,UAAU,GAAG,KAAK,CAAC,cAAc,CAAC,QAAQ,CAAC,CAAC;QAChD,KAAK,IAAI,EAAE,IAAI,UAAU,EACzB;YACC,IAAI,KAAK,GAAG,UAAU,CAAC,EAAE,CAAU,CAAC;YACpC,IAAI,KAAK,IAAI,SAAS,EACtB;gBACC,IAAI,GAAG,GAAG,KAAK,CAAC,MAAqB,CAAC;gBACtC,IAAI,GAAG,CAAC,IAAI,EACZ;oBACC,cAAc,CAAC,KAAK,CAAC,KAAK,CAAC,IAAI,EAAE,QAAQ,CAAC,CAAA;iBAC1C;aACD;SACD;QAED,IAAI,cAAc,GAAG,KAAK,CAAC,uBAAuB,CAAC,QAAQ,CAAC,CAAC;QAC7D,KAAK,IAAI,EAAE,IAAI,cAAc,EAC7B;YACC,IAAI,SAAS,GAAG,cAAc,CAAC,EAAE,CAAmB,CAAC;YACrD,IAAI,SAAS,IAAI,SAAS,EAC1B;gBACC,IAAI,MAAM,GAAG,SAAS,CAAC,MAAyB,CAAC;gBACjD,IAAI,MAAM,CAAC,IAAI,EACf;oBACC,kBAAkB,CAAC,SAAS,CAAC,SAAS,CAAC,EAAE,EAAE,QAAQ,CAAC,CAAC;iBACrD;aACD;SACD;QAED,IAAI,eAAe,GAAG,KAAK,CAAC,cAAc,CAAC,QAAQ,CAAC,CAAC;QACrD,KAAK,IAAI,EAAE,IAAI,eAAe,EAC9B;YACC,IAAI,KAAK,GAAG,eAAe,CAAC,EAAE,CAAC,CAAC;YAChC,IAAI,CAAC,GAAG,KAAK,CAAC,MAAqB,CAAA;YACnC,KAAK,CAAC,MAAM,CAAC,IAAI,CAAC,aAAa,CAAC,CAAC,CAAC,OAAO,CAAmB,CAAC,CAAA;SAC7D;IACF,CAAC;IAEc,uBAAW,GAA1B,UAA2B,IAAW,EAAE,QAAgB;QAEvD,IAAI,CAAC,IAAI,CAAC,OAAO,CAAC,OAAO,EACzB;YACC,IAAI,CAAC,KAAK,EAAE,CAAC;SACb;QACD,IAAI,IAAI,CAAC,OAAO,CAAC,QAAQ,EACzB;YACC,IAAI,CAAC,MAAM,EAAE,CAAC;YACd,cAAc,CAAC,MAAM,CAAC,IAAI,CAAC,OAAO,CAAC,UAAU,EAAE,QAAQ,CAAC,CAAC;SACzD;QACD,IAAI,IAAI,CAAC,OAAO,CAAC,OAAO,EACxB;YACC,IAAI,CAAC,QAAQ,EAAE,CAAC;YAChB,IAAI,IAAI,CAAC,OAAO,CAAC,QAAQ,EACzB;gBACC,IAAI,CAAC,MAAM,EAAE,CAAC;gBACd,cAAc,CAAC,MAAM,CAAC,IAAI,CAAC,OAAO,CAAC,UAAU,EAAE,QAAQ,CAAC,CAAC;aACzD;SACD;IAEF,CAAC;IACc,4BAAgB,GAA/B,UAAgC,QAAgB;QAE/C,WAAW,CAAC,OAAO,CAAC,QAAQ,CAAC,CAAC;QAC9B,WAAW,CAAC,OAAO,CAAC,QAAQ,CAAC,CAAC;IAC/B,CAAC;IACc,0BAAc,GAA7B,UAA8B,QAAgB;QAE7C,OAAO,CAAC,QAAQ,CAAC,QAAQ,CAAC,CAAC;QAC3B,SAAS,CAAC,QAAQ,CAAC,QAAQ,CAAC,CAAC;QAC7B,KAAK,CAAC,QAAQ,CAAC,QAAQ,CAAC,CAAC;QACzB,OAAO,CAAC,QAAQ,CAAC,QAAQ,CAAC,CAAC;IAC5B,CAAC;IACF,kBAAC;AAAD,CAAC,AArHD,IAqHC"}}
