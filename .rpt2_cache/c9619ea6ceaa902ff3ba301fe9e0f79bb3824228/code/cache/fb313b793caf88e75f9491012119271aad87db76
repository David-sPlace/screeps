{"code":"import * as tslib_1 from \"tslib\";\r\nimport { CreepTask } from \"tasks/CreepTask\";\r\nimport { CreepTaskRequest } from \"tasks/CreepTaskRequest\";\r\nimport { CreepTaskQueue } from \"../CreepTaskQueue\";\r\nvar RepairRequest = /** @class */ (function (_super) {\r\n    tslib_1.__extends(RepairRequest, _super);\r\n    function RepairRequest(roomName, siteID) {\r\n        var _this = _super.call(this, roomName, \"\\uD83D\\uDEA7\", siteID) || this;\r\n        _this.name = \"Repair\";\r\n        _this.maxConcurrentCount = 2;\r\n        return _this;\r\n    }\r\n    RepairRequest.maxHitPoints = 500000;\r\n    return RepairRequest;\r\n}(CreepTaskRequest));\r\nexport { RepairRequest };\r\nvar RepairTask = /** @class */ (function (_super) {\r\n    tslib_1.__extends(RepairTask, _super);\r\n    function RepairTask(taskInfo) {\r\n        return _super.call(this, taskInfo) || this;\r\n    }\r\n    RepairTask.addRepairTask = function (roomName) {\r\n        var room = Game.rooms[roomName];\r\n        var targets = room.find(FIND_STRUCTURES)\r\n            .filter(function (structure) { return structure.hits < structure.hitsMax * .9 && structure.hits < RepairRequest.maxHitPoints; })\r\n            .sort(function (a, b) { return a.hits - b.hits; });\r\n        targets.sort(function (a, b) { return a.hits - b.hits; });\r\n        for (var id in targets) {\r\n            var thing = targets[id];\r\n            var request = new RepairRequest(roomName, thing.id);\r\n            var existingTaskCount = CreepTaskQueue.totalCount(roomName, request.name);\r\n            if (existingTaskCount < request.maxConcurrentCount) {\r\n                CreepTaskQueue.addPending(request);\r\n            }\r\n        }\r\n    };\r\n    RepairTask.prototype.doWork = function () {\r\n        var info = this.request;\r\n        var site = Game.getObjectById(info.targetID);\r\n        var creep = Game.creeps[this.request.assignedTo];\r\n        if (site != undefined) {\r\n            if (creep.repair(site) == ERR_NOT_IN_RANGE) {\r\n                creep.moveTo(site, { visualizePathStyle: { stroke: '#ffffff' } });\r\n                creep.say('ðŸ› ');\r\n            }\r\n            if (site.hitsMax == site.hits || site.hits > RepairRequest.maxHitPoints) {\r\n                this.request.finished = true;\r\n                return;\r\n            }\r\n        }\r\n        else\r\n            this.request.finished = true;\r\n    };\r\n    return RepairTask;\r\n}(CreepTask));\r\nexport { RepairTask };\r\n//# sourceMappingURL=Repair.js.map","map":{"version":3,"file":"Repair.js","sourceRoot":"","sources":["../../src/tasks/creep/Repair.ts"],"names":[],"mappings":";AAAA,OAAO,EAAE,SAAS,EAAE,MAAM,iBAAiB,CAAC;AAC5C,OAAO,EAAE,gBAAgB,EAAE,MAAM,wBAAwB,CAAC;AAC1D,OAAO,EAAE,cAAc,EAAE,MAAM,mBAAmB,CAAC;AAEnD;IAAmC,yCAAgB;IAKlD,uBAAY,QAAgB,EAAE,MAAc;QAA5C,YAEC,kBAAM,QAAQ,EAAE,cAAI,EAAE,MAAM,CAAC,SAC7B;QAND,UAAI,GAAG,QAAQ,CAAC;QAChB,wBAAkB,GAAG,CAAC,CAAC;;IAKvB,CAAC;IAJM,0BAAY,GAAG,MAAM,CAAC;IAK9B,oBAAC;CAAA,AATD,CAAmC,gBAAgB,GASlD;SATY,aAAa;AAU1B;IAAgC,sCAAS;IAExC,oBAAY,QAA0B;eAErC,kBAAM,QAAQ,CAAC;IAChB,CAAC;IACM,wBAAa,GAApB,UAAqB,QAAgB;QAEpC,IAAI,IAAI,GAAG,IAAI,CAAC,KAAK,CAAC,QAAQ,CAAC,CAAC;QAChC,IAAM,OAAO,GAAG,IAAI,CAAC,IAAI,CAAC,eAAe,CAAC;aACzC,MAAM,CAAC,UAAA,SAAS,IAAI,OAAA,SAAS,CAAC,IAAI,GAAG,SAAS,CAAC,OAAO,GAAC,EAAE,IAAI,SAAS,CAAC,IAAI,GAAG,aAAa,CAAC,YAAY,EAApF,CAAoF,CAAC;aACzG,IAAI,CAAC,UAAC,CAAC,EAAC,CAAC,IAAK,OAAA,CAAC,CAAC,IAAI,GAAG,CAAC,CAAC,IAAI,EAAf,CAAe,CAAC,CAAC;QAEhC,OAAO,CAAC,IAAI,CAAC,UAAC,CAAC,EAAE,CAAC,IAAK,OAAA,CAAC,CAAC,IAAI,GAAG,CAAC,CAAC,IAAI,EAAf,CAAe,CAAC,CAAC;QAExC,KAAK,IAAM,EAAE,IAAI,OAAO,EACxB;YACC,IAAI,KAAK,GAAG,OAAO,CAAC,EAAE,CAAC,CAAC;YACxB,IAAI,OAAO,GAAG,IAAI,aAAa,CAAC,QAAQ,EAAE,KAAK,CAAC,EAAE,CAAC,CAAC;YACpD,IAAI,iBAAiB,GAAG,cAAc,CAAC,UAAU,CAAC,QAAQ,EAAE,OAAO,CAAC,IAAI,CAAC,CAAC;YAE1E,IAAI,iBAAiB,GAAG,OAAO,CAAC,kBAAkB,EAClD;gBACC,cAAc,CAAC,UAAU,CAAC,OAAO,CAAC,CAAC;aACnC;SACD;IAEF,CAAC;IACD,2BAAM,GAAN;QAEC,IAAI,IAAI,GAAG,IAAI,CAAC,OAAwB,CAAC;QACzC,IAAI,IAAI,GAAG,IAAI,CAAC,aAAa,CAAC,IAAI,CAAC,QAAQ,CAAiB,CAAC;QAC7D,IAAI,KAAK,GAAG,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,OAAO,CAAC,UAAU,CAAU,CAAC;QAE1D,IAAI,IAAI,IAAI,SAAS,EACrB;YACC,IAAI,KAAK,CAAC,MAAM,CAAC,IAAI,CAAC,IAAI,gBAAgB,EAC1C;gBACC,KAAK,CAAC,MAAM,CAAC,IAAI,EAAE,EAAE,kBAAkB,EAAE,EAAE,MAAM,EAAE,SAAS,EAAE,EAAE,CAAC,CAAC;gBAClE,KAAK,CAAC,GAAG,CAAC,IAAI,CAAC,CAAC;aAChB;YACD,IAAI,IAAI,CAAC,OAAO,IAAI,IAAI,CAAC,IAAI,IAAI,IAAI,CAAC,IAAI,GAAG,aAAa,CAAC,YAAY,EACvE;gBACC,IAAI,CAAC,OAAO,CAAC,QAAQ,GAAG,IAAI,CAAC;gBAC7B,OAAO;aACP;SACD;;YACI,IAAI,CAAC,OAAO,CAAC,QAAQ,GAAG,IAAI,CAAC;IAEnC,CAAC;IACF,iBAAC;AAAD,CAAC,AAlDD,CAAgC,SAAS,GAkDxC"}}
