{"code":"import * as tslib_1 from \"tslib\";\r\nimport { CreepTask } from \"tasks/CreepTask\";\r\nimport { CreepTaskRequest } from \"tasks/CreepTaskRequest\";\r\nimport { CreepTaskQueue } from \"../CreepTaskQueue\";\r\nimport * as utils from \"utils/utils\";\r\nimport { RoomManager } from \"RoomManager\";\r\nvar FillContainersRequest = /** @class */ (function (_super) {\r\n    tslib_1.__extends(FillContainersRequest, _super);\r\n    function FillContainersRequest(roomName, containerID) {\r\n        var _this = _super.call(this, roomName, \"\\uD83D\\uDCB2\", containerID) || this;\r\n        _this.name = \"FillContainer\";\r\n        _this.maxConcurrentCount = 1;\r\n        return _this;\r\n    }\r\n    return FillContainersRequest;\r\n}(CreepTaskRequest));\r\nexport { FillContainersRequest };\r\nvar FillContainers = /** @class */ (function (_super) {\r\n    tslib_1.__extends(FillContainers, _super);\r\n    function FillContainers(taskInfo) {\r\n        return _super.call(this, taskInfo) || this;\r\n    }\r\n    FillContainers.prototype.start = function () {\r\n        _super.prototype.start.call(this);\r\n    };\r\n    FillContainers.prototype.continue = function () {\r\n        if (this.request.finished)\r\n            return;\r\n        var creep = Game.creeps[this.request.assignedTo];\r\n        if (creep === undefined || creep.memory === undefined) {\r\n            this.request.finished = true;\r\n            return;\r\n        }\r\n        var creepMemory = creep.memory;\r\n        if (creep.carry.energy == 0) {\r\n            creepMemory.preppingForTask = true;\r\n        }\r\n        this.doWork();\r\n        // if (creepMemory.preppingForTask)\r\n        // {\r\n        // \tcreepMemory.preppingForTask = true;\r\n        // \tthis.collect(this.request.roomName, creep.id, () => { });\r\n        // }\r\n        // else\r\n        // {\r\n        // \tthis.doWork();\r\n        // }\r\n    };\r\n    FillContainers.prototype.doWork = function () {\r\n        var request = this.request;\r\n        var creep = Game.creeps[request.assignedTo];\r\n        var mem = creep.memory;\r\n        var creep = Game.creeps[this.request.assignedTo];\r\n        var mem = creep.memory;\r\n        var closestSpot = RoomManager.GetClosestOrAssignedHarvestLocation(this.request.roomName, creep.id);\r\n        if (closestSpot == undefined) {\r\n            if (Game.time % 5 == 0)\r\n                creep.say(\"\\u231B\");\r\n            var home = Game.getObjectById(mem.spawnID);\r\n            creep.moveTo(home.pos.x, home.pos.y);\r\n            return;\r\n        }\r\n        if (mem.preppingForTask) {\r\n            var source = Game.getObjectById(closestSpot.sourceID);\r\n            if (creep.pos.getRangeTo(closestSpot.pos.x, closestSpot.pos.y) > 0) {\r\n                creep.moveTo(closestSpot.pos.x, closestSpot.pos.y, { visualizePathStyle: { stroke: '#ffaa00' } });\r\n                return;\r\n            }\r\n            creep.harvest(source);\r\n            if (creep.carry.energy == creep.carryCapacity) {\r\n                mem.preppingForTask = false;\r\n                if (closestSpot != undefined) {\r\n                    closestSpot.assignedTo = null;\r\n                }\r\n            }\r\n        }\r\n        else {\r\n            if (creep.carry.energy == 0) {\r\n                request.finished = true;\r\n                mem.idle = true;\r\n                return;\r\n            }\r\n            this.deliverToContainer();\r\n        }\r\n    };\r\n    FillContainers.prototype.deliverToContainer = function () {\r\n        var container = Game.getObjectById(this.request.targetID);\r\n        var creep = Game.creeps[this.request.assignedTo];\r\n        if (creep.transfer(container, RESOURCE_ENERGY) == ERR_NOT_IN_RANGE) {\r\n            creep.moveTo(container, { visualizePathStyle: { stroke: '#ffffff' } });\r\n        }\r\n    };\r\n    return FillContainers;\r\n}(CreepTask));\r\nexport { FillContainers };\r\nvar RestockRequest = /** @class */ (function (_super) {\r\n    tslib_1.__extends(RestockRequest, _super);\r\n    function RestockRequest(roomName, restockID) {\r\n        var _this = _super.call(this, roomName, \"\\uD83D\\uDED2\", restockID) || this;\r\n        _this.name = \"Restock\";\r\n        _this.maxConcurrentCount = 10;\r\n        return _this;\r\n    }\r\n    return RestockRequest;\r\n}(CreepTaskRequest));\r\nexport { RestockRequest };\r\nvar Restock = /** @class */ (function (_super) {\r\n    tslib_1.__extends(Restock, _super);\r\n    function Restock(taskInfo) {\r\n        return _super.call(this, taskInfo) || this;\r\n    }\r\n    Restock.prototype.doWork = function () {\r\n        var creep = Game.creeps[this.request.assignedTo];\r\n        var targets = creep.room.find(FIND_STRUCTURES, {\r\n            filter: function (structure) {\r\n                return (structure.structureType == STRUCTURE_EXTENSION || structure.structureType == STRUCTURE_SPAWN) &&\r\n                    structure.energy < structure.energyCapacity;\r\n            }\r\n        }).sort(function (structureA, structureB) { return creep.pos.getRangeTo(structureA) - creep.pos.getRangeTo(structureB); });\r\n        if (creep.carry.energy == 0 || targets.length == 0) {\r\n            this.request.finished = true;\r\n            return;\r\n        }\r\n        if (creep.transfer(targets[0], RESOURCE_ENERGY) == ERR_NOT_IN_RANGE) {\r\n            creep.moveTo(targets[0], { visualizePathStyle: { stroke: '#ffffff' } });\r\n        }\r\n    };\r\n    Restock.addTasks = function (roomName) {\r\n        var restockables = utils.getRestockables(roomName);\r\n        for (var targetID in restockables) {\r\n            var restockable = restockables[targetID];\r\n            var request = new RestockRequest(roomName, restockable.id);\r\n            var existingTaskCount = CreepTaskQueue.totalCount(roomName, request.name);\r\n            var maxConcurrentCount = request.maxConcurrentCount;\r\n            if (existingTaskCount < maxConcurrentCount) {\r\n                CreepTaskQueue.addPending(request);\r\n            }\r\n        }\r\n    };\r\n    return Restock;\r\n}(CreepTask));\r\nexport { Restock };\r\n//# sourceMappingURL=Restock.js.map","map":{"version":3,"file":"Restock.js","sourceRoot":"","sources":["../../src/tasks/creep/Restock.ts"],"names":[],"mappings":";AAAA,OAAO,EAAE,SAAS,EAAE,MAAM,iBAAiB,CAAC;AAC5C,OAAO,EAAE,gBAAgB,EAAE,MAAM,wBAAwB,CAAC;AAC1D,OAAO,EAAE,cAAc,EAAE,MAAM,mBAAmB,CAAC;AACnD,OAAO,KAAK,KAAK,MAAM,aAAa,CAAA;AACpC,OAAO,EAAE,WAAW,EAAE,MAAM,aAAa,CAAC;AAG1C;IAA2C,iDAAgB;IAI1D,+BAAY,QAAgB,EAAE,WAAmB;QAAjD,YAEC,kBAAM,QAAQ,EAAE,cAAI,EAAE,WAAW,CAAC,SAClC;QALD,UAAI,GAAW,eAAe,CAAC;QAC/B,wBAAkB,GAAW,CAAC,CAAC;;IAI/B,CAAC;IACF,4BAAC;AAAD,CAAC,AARD,CAA2C,gBAAgB,GAQ1D;;AAGD;IAAoC,0CAAS;IA4F5C,wBAAY,QAA0B;eAErC,kBAAM,QAAQ,CAAC;IAChB,CAAC;IA7FD,8BAAK,GAAL;QACC,iBAAM,KAAK,WAAE,CAAC;IAEf,CAAC;IACD,iCAAQ,GAAR;QACC,IAAG,IAAI,CAAC,OAAO,CAAC,QAAQ;YAAE,OAAO;QAEjC,IAAI,KAAK,GAAG,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,OAAO,CAAC,UAAU,CAAU,CAAC;QAC1D,IAAI,KAAK,KAAK,SAAS,IAAI,KAAK,CAAC,MAAM,KAAK,SAAS,EACrD;YACC,IAAI,CAAC,OAAO,CAAC,QAAQ,GAAG,IAAI,CAAC;YAC7B,OAAO;SACP;QAED,IAAI,WAAW,GAAgB,KAAK,CAAC,MAAqB,CAAC;QAE3D,IAAI,KAAK,CAAC,KAAK,CAAC,MAAM,IAAI,CAAC,EAC3B;YACC,WAAW,CAAC,eAAe,GAAG,IAAI,CAAC;SACnC;QAED,IAAI,CAAC,MAAM,EAAE,CAAC;QACd,mCAAmC;QACnC,IAAI;QACJ,uCAAuC;QACvC,6DAA6D;QAC7D,IAAI;QACJ,OAAO;QACP,IAAI;QACJ,kBAAkB;QAClB,IAAI;IACL,CAAC;IACS,+BAAM,GAAhB;QAEC,IAAI,OAAO,GAAG,IAAI,CAAC,OAAgC,CAAC;QACpD,IAAI,KAAK,GAAG,IAAI,CAAC,MAAM,CAAC,OAAO,CAAC,UAAU,CAAC,CAAC;QAE5C,IAAI,GAAG,GAAG,KAAK,CAAC,MAAqB,CAAC;QAEtC,IAAI,KAAK,GAAG,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,OAAO,CAAC,UAAU,CAAU,CAAC;QAC1D,IAAI,GAAG,GAAG,KAAK,CAAC,MAAqB,CAAC;QACtC,IAAI,WAAW,GAAG,WAAW,CAAC,mCAAmC,CAAC,IAAI,CAAC,OAAO,CAAC,QAAQ,EAAE,KAAK,CAAC,EAAE,CAAgB,CAAC;QAClH,IAAI,WAAW,IAAI,SAAS,EAC5B;YACC,IAAI,IAAI,CAAC,IAAI,GAAG,CAAC,IAAI,CAAC;gBAAE,KAAK,CAAC,GAAG,CAAC,QAAG,CAAC,CAAC;YAEvC,IAAI,IAAI,GAAG,IAAI,CAAC,aAAa,CAAC,GAAG,CAAC,OAAO,CAAmB,CAAC;YAC7D,KAAK,CAAC,MAAM,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC,EAAE,IAAI,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC;YACrC,OAAO;SACP;QAED,IAAI,GAAG,CAAC,eAAe,EACvB;YACC,IAAI,MAAM,GAAG,IAAI,CAAC,aAAa,CAAC,WAAW,CAAC,QAAQ,CAAW,CAAA;YAC/D,IAAI,KAAK,CAAC,GAAG,CAAC,UAAU,CAAC,WAAW,CAAC,GAAG,CAAC,CAAC,EAAE,WAAW,CAAC,GAAG,CAAC,CAAC,CAAC,GAAG,CAAC,EAClE;gBACC,KAAK,CAAC,MAAM,CAAC,WAAW,CAAC,GAAG,CAAC,CAAC,EAAE,WAAW,CAAC,GAAG,CAAC,CAAC,EAAE,EAAE,kBAAkB,EAAE,EAAE,MAAM,EAAE,SAAS,EAAE,EAAE,CAAC,CAAC;gBAClG,OAAO;aACP;YACD,KAAK,CAAC,OAAO,CAAC,MAAM,CAAC,CAAC;YACtB,IAAI,KAAK,CAAC,KAAK,CAAC,MAAM,IAAI,KAAK,CAAC,aAAa,EAC7C;gBACC,GAAG,CAAC,eAAe,GAAG,KAAK,CAAC;gBAC5B,IAAI,WAAW,IAAI,SAAS,EAC5B;oBACC,WAAW,CAAC,UAAU,GAAG,IAAI,CAAC;iBAC9B;aACD;SACD;aAED;YACC,IAAI,KAAK,CAAC,KAAK,CAAC,MAAM,IAAI,CAAC,EAC3B;gBACC,OAAO,CAAC,QAAQ,GAAG,IAAI,CAAC;gBACxB,GAAG,CAAC,IAAI,GAAG,IAAI,CAAA;gBACf,OAAO;aACP;YACD,IAAI,CAAC,kBAAkB,EAAE,CAAC;SAE1B;IACF,CAAC;IACO,2CAAkB,GAA1B;QAEC,IAAI,SAAS,GAAG,IAAI,CAAC,aAAa,CAAC,IAAI,CAAC,OAAO,CAAC,QAAQ,CAAuB,CAAC;QAChF,IAAI,KAAK,GAAG,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,OAAO,CAAC,UAAU,CAAC,CAAC;QACjD,IAAI,KAAK,CAAC,QAAQ,CAAC,SAAS,EAAE,eAAe,CAAC,IAAI,gBAAgB,EAClE;YACC,KAAK,CAAC,MAAM,CAAC,SAAS,EAAE,EAAE,kBAAkB,EAAE,EAAE,MAAM,EAAE,SAAS,EAAE,EAAE,CAAC,CAAC;SACvE;IACF,CAAC;IAKF,qBAAC;AAAD,CAAC,AAhGD,CAAoC,SAAS,GAgG5C;;AAID;IAAoC,0CAAgB;IAInD,wBAAY,QAAgB,EAAE,SAAiB;QAA/C,YAEC,kBAAM,QAAQ,EAAE,cAAI,EAAE,SAAS,CAAC,SAChC;QALD,UAAI,GAAG,SAAS,CAAC;QACjB,wBAAkB,GAAG,EAAE,CAAC;;IAIxB,CAAC;IACF,qBAAC;AAAD,CAAC,AARD,CAAoC,gBAAgB,GAQnD;;AAED;IAA6B,mCAAS;IAErC,iBAAY,QAA0B;eAErC,kBAAM,QAAQ,CAAC;IAChB,CAAC;IAED,wBAAM,GAAN;QAEC,IAAI,KAAK,GAAG,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,OAAO,CAAC,UAAU,CAAU,CAAC;QAC1D,IAAI,OAAO,GAAG,KAAK,CAAC,IAAI,CAAC,IAAI,CAAC,eAAe,EAAE;YAC9C,MAAM,EAAE,UAAC,SAAS;gBAEjB,OAAO,CAAC,SAAS,CAAC,aAAa,IAAI,mBAAmB,IAAI,SAAS,CAAC,aAAa,IAAI,eAAe,CAAC;oBACpG,SAAS,CAAC,MAAM,GAAG,SAAS,CAAC,cAAc,CAAC;YAC9C,CAAC;SACD,CAAC,CAAC,IAAI,CAAC,UAAC,UAAU,EAAE,UAAU,IAAK,OAAA,KAAK,CAAC,GAAG,CAAC,UAAU,CAAC,UAAU,CAAC,GAAG,KAAK,CAAC,GAAG,CAAC,UAAU,CAAC,UAAU,CAAC,EAAnE,CAAmE,CAAC,CAAC;QACzG,IAAI,KAAK,CAAC,KAAK,CAAC,MAAM,IAAI,CAAC,IAAI,OAAO,CAAC,MAAM,IAAI,CAAC,EAClD;YACC,IAAI,CAAC,OAAO,CAAC,QAAQ,GAAG,IAAI,CAAC;YAC7B,OAAO;SACP;QACD,IAAI,KAAK,CAAC,QAAQ,CAAC,OAAO,CAAC,CAAC,CAAC,EAAE,eAAe,CAAC,IAAI,gBAAgB,EACnE;YACC,KAAK,CAAC,MAAM,CAAC,OAAO,CAAC,CAAC,CAAC,EAAE,EAAE,kBAAkB,EAAE,EAAE,MAAM,EAAE,SAAS,EAAE,EAAE,CAAC,CAAC;SACxE;IAEF,CAAC;IACM,gBAAQ,GAAf,UAAgB,QAAgB;QAE/B,IAAI,YAAY,GAAG,KAAK,CAAC,eAAe,CAAC,QAAQ,CAAC,CAAA;QAElD,KAAK,IAAM,QAAQ,IAAI,YAAY,EACnC;YACC,IAAI,WAAW,GAAG,YAAY,CAAC,QAAQ,CAAC,CAAC;YACzC,IAAI,OAAO,GAAG,IAAI,cAAc,CAAC,QAAQ,EAAE,WAAW,CAAC,EAAE,CAAC,CAAC;YAC3D,IAAI,iBAAiB,GAAG,cAAc,CAAC,UAAU,CAAC,QAAQ,EAAE,OAAO,CAAC,IAAI,CAAC,CAAC;YAC1E,IAAI,kBAAkB,GAAG,OAAO,CAAC,kBAAkB,CAAC;YAEpD,IAAI,iBAAiB,GAAG,kBAAkB,EAC1C;gBACC,cAAc,CAAC,UAAU,CAAC,OAAO,CAAC,CAAA;aAClC;SACD;IACF,CAAC;IACF,cAAC;AAAD,CAAC,AA7CD,CAA6B,SAAS,GA6CrC"}}
