{"code":"import * as tslib_1 from \"tslib\";\r\nimport { RoomManager } from \"RoomManager\";\r\nvar CreepTaskRequest = /** @class */ (function () {\r\n    function CreepTaskRequest(roomName, wingDing, targetID) {\r\n        if (targetID === void 0) { targetID = \"\"; }\r\n        this.isCreepTask = false;\r\n        this.started = false;\r\n        this.finished = false;\r\n        this.assignedTo = \"\";\r\n        this.targetID = targetID;\r\n        this.roomName = roomName;\r\n        this.wingDing = wingDing;\r\n    }\r\n    return CreepTaskRequest;\r\n}());\r\nexport { CreepTaskRequest };\r\nvar StructureTaskInfo = /** @class */ (function () {\r\n    function StructureTaskInfo(roomName, targetID) {\r\n        if (targetID === void 0) { targetID = \"\"; }\r\n        this.started = false;\r\n        this.finished = false;\r\n        this.assignedTo = \"\";\r\n        this.roomName = roomName;\r\n        this.targetID = targetID;\r\n        this.isCreepTask = false;\r\n    }\r\n    return StructureTaskInfo;\r\n}());\r\nexport { StructureTaskInfo };\r\nvar Task = /** @class */ (function () {\r\n    function Task(taskInfo) {\r\n        this.request = taskInfo;\r\n    }\r\n    Task.prototype.start = function () {\r\n        this.request.started = true;\r\n        this.request.finished = false;\r\n    };\r\n    Task.prototype.continue = function () {\r\n        if (this.request.assignedTo == \"\") {\r\n            this.request.finished = true;\r\n            return;\r\n        }\r\n    };\r\n    Task.prototype.finish = function () {\r\n        this.request.finished = true;\r\n    };\r\n    return Task;\r\n}());\r\nexport { Task };\r\nvar StructureTask = /** @class */ (function (_super) {\r\n    tslib_1.__extends(StructureTask, _super);\r\n    function StructureTask(taskInfo) {\r\n        return _super.call(this, taskInfo) || this;\r\n        // this.taskInfo = taskInfo as BuildingTaskInfo;\r\n    }\r\n    StructureTask.prototype.start = function () {\r\n        _super.prototype.start.call(this);\r\n        //var building = Game.getObjectById(this.taskInfo.assignedTo) as AnyOwnedStructure\r\n        //console.log(building.structureType + \":\" + building.id + \" is starting a \" + this.taskInfo.name + \" task.\")\r\n    };\r\n    StructureTask.prototype.continue = function () {\r\n        _super.prototype.continue.call(this);\r\n        if (this.request.finished)\r\n            return;\r\n        var building = Game.getObjectById(this.request.assignedTo);\r\n        if (building == undefined) {\r\n            this.request.finished = true;\r\n            return;\r\n        }\r\n        this.doWork();\r\n    };\r\n    StructureTask.prototype.finish = function () {\r\n        _super.prototype.finish.call(this);\r\n    };\r\n    return StructureTask;\r\n}(Task));\r\nexport { StructureTask };\r\nvar CreepTask = /** @class */ (function (_super) {\r\n    tslib_1.__extends(CreepTask, _super);\r\n    function CreepTask(taskInfo) {\r\n        var _this = _super.call(this, taskInfo) || this;\r\n        _this.request = taskInfo;\r\n        return _this;\r\n    }\r\n    CreepTask.prototype.start = function () {\r\n        _super.prototype.start.call(this);\r\n        var creep = Game.creeps[this.request.assignedTo];\r\n        //console.log(creep.name + \" is starting its \" + this.request.name + \" task.\")\r\n        var creepMem = creep.memory;\r\n        creepMem.currentTask = this.request.name;\r\n        creepMem.idle = false;\r\n        if (creep.carry.energy < creep.carryCapacity / 2) {\r\n            creepMem.preppingForTask = true;\r\n        }\r\n    };\r\n    CreepTask.prototype.continue = function () {\r\n        _super.prototype.continue.call(this);\r\n        if (this.request.finished)\r\n            return;\r\n        var creep = Game.creeps[this.request.assignedTo];\r\n        if (creep === undefined || creep.memory === undefined) {\r\n            this.request.finished = true;\r\n            return;\r\n        }\r\n        var creepMemory = creep.memory;\r\n        if (creep.carry.energy == 0) {\r\n            creepMemory.preppingForTask = true;\r\n        }\r\n        if (creepMemory.preppingForTask) {\r\n            creepMemory.preppingForTask = true;\r\n            this.collect(this.request.roomName, creep.id, function () { });\r\n        }\r\n        else {\r\n            this.moveoutdaway();\r\n            this.doWork();\r\n        }\r\n    };\r\n    CreepTask.prototype.finish = function () {\r\n        _super.prototype.finish.call(this);\r\n        var creep = Game.creeps[this.request.assignedTo];\r\n        if (creep !== undefined) {\r\n            creep.say(\"âœ”\");\r\n            var mem = creep.memory;\r\n            mem.idle = true;\r\n            mem.preppingForTask = false;\r\n            mem.currentTask = \"\";\r\n            //console.log(creep.name + \" is finishing its \" + this.taskInfo.name + \" task.\")\r\n        }\r\n    };\r\n    CreepTask.prototype.moveoutdaway = function () {\r\n        var roomMem = Game.rooms[this.request.roomName].memory;\r\n        var creep = Game.creeps[this.request.assignedTo];\r\n        var harvestLocs = roomMem.harvestLocations;\r\n        var creepMem = creep.memory;\r\n        if (creepMem.preppingForTask)\r\n            return;\r\n        for (var id in harvestLocs) {\r\n            var loc = harvestLocs[id];\r\n            if (creep.pos.getRangeTo(loc.pos.x, loc.pos.y) < 1) {\r\n                //creep.say(\"moving!\")\r\n                creep.moveTo(Game.getObjectById(creepMem.spawnID));\r\n            }\r\n        }\r\n    };\r\n    CreepTask.prototype.collect = function (roomName, creepID, energyFullCallback) {\r\n        var creep = Game.getObjectById(creepID);\r\n        var mem = creep.memory;\r\n        var closestSpot = RoomManager.GetClosestOrAssignedHarvestLocation(roomName, creepID);\r\n        if (creep.carry.energy < creep.carryCapacity) {\r\n            if (Game.time % 5 == 0) {\r\n                creep.say(\"\" + this.request.wingDing);\r\n            }\r\n            if (closestSpot != undefined) {\r\n                var source = Game.getObjectById(closestSpot.sourceID);\r\n                if (creep.pos.getRangeTo(closestSpot.pos.x, closestSpot.pos.y) > 0) {\r\n                    creep.moveTo(closestSpot.pos.x, closestSpot.pos.y, { visualizePathStyle: { stroke: '#ffaa00' } });\r\n                }\r\n                else {\r\n                    creep.harvest(source);\r\n                    if (source.energy == 0) {\r\n                        mem.preppingForTask = false;\r\n                        if (closestSpot != undefined) {\r\n                            closestSpot.assignedTo = null;\r\n                        }\r\n                        energyFullCallback();\r\n                    }\r\n                }\r\n            }\r\n            else {\r\n                creep.say(\"\\u231B\");\r\n                var home = Game.getObjectById(mem.spawnID);\r\n                creep.moveTo(home.pos.x, home.pos.y);\r\n            }\r\n        }\r\n        else {\r\n            //console.log (closestSpot.assignedTo + \" has been unassigned.\")\r\n            mem.preppingForTask = false;\r\n            if (closestSpot != undefined) {\r\n                closestSpot.assignedTo = null;\r\n            }\r\n            energyFullCallback();\r\n        }\r\n    };\r\n    return CreepTask;\r\n}(Task));\r\nexport { CreepTask };\r\n//# sourceMappingURL=WorkerTask.js.map","map":{"version":3,"file":"WorkerTask.js","sourceRoot":"","sources":["../src/abstract/WorkerTask.ts"],"names":[],"mappings":"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"}}
