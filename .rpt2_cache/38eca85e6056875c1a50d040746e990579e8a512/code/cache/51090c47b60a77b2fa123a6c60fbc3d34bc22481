{"code":"import * as tslib_1 from \"tslib\";\r\nimport { CreepTask } from \"tasks/CreepTask\";\r\nimport { CreepTaskRequest } from \"tasks/CreepTaskRequest\";\r\nimport { CreepTaskQueue } from \"../CreepTaskQueue\";\r\nvar TransferEnergyRequest = /** @class */ (function (_super) {\r\n    tslib_1.__extends(TransferEnergyRequest, _super);\r\n    function TransferEnergyRequest(roomName, transferToID, transferFromID) {\r\n        var _this = _super.call(this, roomName, \"\\u2196\", transferToID) || this;\r\n        _this.name = \"TransferEnergy\";\r\n        _this.requiredRole = 3 /* ROLE_WORKER */;\r\n        _this.maxConcurrentCount = 1;\r\n        _this.transferFromID = transferFromID;\r\n        return _this;\r\n    }\r\n    return TransferEnergyRequest;\r\n}(CreepTaskRequest));\r\nexport { TransferEnergyRequest };\r\nvar TransferEnergy = /** @class */ (function (_super) {\r\n    tslib_1.__extends(TransferEnergy, _super);\r\n    function TransferEnergy(taskInfo) {\r\n        return _super.call(this, taskInfo) || this;\r\n    }\r\n    TransferEnergy.prototype.continue = function () {\r\n        var creep = Game.creeps[this.request.assignedTo];\r\n        var cMem = creep.memory;\r\n        if (this.request.assignedTo == \"\" || creep === undefined || creep.memory === undefined) {\r\n            this.request.finished = true;\r\n            return;\r\n        }\r\n        if (creep.carry.energy == creep.carryCapacity) {\r\n            cMem.preppingForTask = false;\r\n        }\r\n        this.doWork();\r\n    };\r\n    TransferEnergy.prototype.doWork = function () {\r\n        var requestInfo = this.request;\r\n        var target = Game.getObjectById(requestInfo.targetID);\r\n        var source = Game.getObjectById(requestInfo.transferFromID);\r\n        var creep = Game.creeps[this.request.assignedTo];\r\n        var cMem = creep.memory;\r\n        if (source.store.energy == 0 || creep.carry.energy == creep.carryCapacity) {\r\n            cMem.preppingForTask = false;\r\n        }\r\n        if (cMem.preppingForTask && creep.withdraw(source, RESOURCE_ENERGY) == ERR_NOT_IN_RANGE) {\r\n            creep.moveTo(source, { visualizePathStyle: { stroke: '#ffaa00' } });\r\n        }\r\n        else if (!cMem.preppingForTask && creep.transfer(target, RESOURCE_ENERGY) == ERR_NOT_IN_RANGE) {\r\n            creep.moveTo(target, { visualizePathStyle: { stroke: '#ffaa00' } });\r\n        }\r\n    };\r\n    return TransferEnergy;\r\n}(CreepTask));\r\nexport { TransferEnergy };\r\nvar BuildRequest = /** @class */ (function (_super) {\r\n    tslib_1.__extends(BuildRequest, _super);\r\n    function BuildRequest(roomName, siteID) {\r\n        var _this = _super.call(this, roomName, \"\\uD83D\\uDEA7\", siteID) || this;\r\n        _this.requiredRole = 3 /* ROLE_WORKER */;\r\n        _this.name = \"Build\";\r\n        _this.maxConcurrentCount = 2;\r\n        return _this;\r\n    }\r\n    return BuildRequest;\r\n}(CreepTaskRequest));\r\nexport { BuildRequest };\r\nvar Build = /** @class */ (function (_super) {\r\n    tslib_1.__extends(Build, _super);\r\n    function Build(taskInfo) {\r\n        return _super.call(this, taskInfo) || this;\r\n    }\r\n    Build.prototype.doWork = function () {\r\n        var info = this.request;\r\n        var site = Game.getObjectById(info.targetID);\r\n        var creep = Game.creeps[this.request.assignedTo];\r\n        var creepMemory = creep.memory;\r\n        if (site == null || creep == undefined) {\r\n            this.request.finished = true;\r\n            return;\r\n        }\r\n        var progressLeft = site.progressTotal - site.progress;\r\n        if (progressLeft == 0) {\r\n            this.request.finished = true;\r\n            return;\r\n        }\r\n        if (creep.build(site) == ERR_NOT_IN_RANGE) {\r\n            creep.moveTo(site, { visualizePathStyle: { stroke: '#ffffff' } });\r\n        }\r\n        if (creep.carry.energy == 0) {\r\n            creepMemory.preppingForTask = true;\r\n        }\r\n    };\r\n    Build.addTasks = function (roomName) {\r\n        var room = Game.rooms[roomName];\r\n        var sites = room.find(FIND_CONSTRUCTION_SITES);\r\n        _.each(sites, function (site) {\r\n            var request = new BuildRequest(roomName, site.id);\r\n            var existingTaskCount = CreepTaskQueue.totalCount(roomName, request.name);\r\n            if (site.progressTotal > 0 && existingTaskCount < request.maxConcurrentCount) {\r\n                //console.log(`Adding a construction task to worker queue.`);\r\n                CreepTaskQueue.addPending(request);\r\n            }\r\n        });\r\n    };\r\n    return Build;\r\n}(CreepTask));\r\nexport { Build };\r\n//# sourceMappingURL=Build.js.map","map":{"version":3,"file":"Build.js","sourceRoot":"","sources":["../../src/tasks/creep/Build.ts"],"names":[],"mappings":"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"}}
