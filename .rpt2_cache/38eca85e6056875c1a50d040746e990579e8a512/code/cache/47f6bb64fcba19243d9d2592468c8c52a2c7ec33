{"code":"import * as tslib_1 from \"tslib\";\r\nimport { CreepTaskRequest } from \"../CreepTaskRequest\";\r\nimport { CreepTask } from \"../CreepTask\";\r\nimport { RoomManager } from \"RoomManager\";\r\nimport { CreepTaskQueue } from \"../CreepTaskQueue\";\r\nvar FillContainersRequest = /** @class */ (function (_super) {\r\n    tslib_1.__extends(FillContainersRequest, _super);\r\n    function FillContainersRequest(roomName, sourceID) {\r\n        var _this = _super.call(this, roomName, \"\\uD83D\\uDCB2\", sourceID) || this;\r\n        _this.requiredRole = 2 /* ROLE_MINER */;\r\n        _this.name = \"FillContainers\";\r\n        _this.maxConcurrentCount = 2;\r\n        return _this;\r\n    }\r\n    return FillContainersRequest;\r\n}(CreepTaskRequest));\r\nexport { FillContainersRequest };\r\nvar FillContainers = /** @class */ (function (_super) {\r\n    tslib_1.__extends(FillContainers, _super);\r\n    function FillContainers(taskInfo) {\r\n        return _super.call(this, taskInfo) || this;\r\n    }\r\n    FillContainers.prototype.start = function () {\r\n        _super.prototype.start.call(this);\r\n    };\r\n    FillContainers.prototype.continue = function () {\r\n        if (this.request.finished)\r\n            return;\r\n        var creep = Game.creeps[this.request.assignedTo];\r\n        if (creep === undefined || creep.memory === undefined) {\r\n            this.request.finished = true;\r\n            return;\r\n        }\r\n        var creepMemory = creep.memory;\r\n        if (creep.carry.energy == 0) {\r\n            creepMemory.preppingForTask = true;\r\n        }\r\n        else if (creep.carry.energy == creep.carryCapacity) {\r\n            creepMemory.preppingForTask = false;\r\n        }\r\n        this.doWork();\r\n    };\r\n    FillContainers.prototype.doWork = function () {\r\n        var request = this.request;\r\n        //var creep = Game.creeps[request.assignedTo];\r\n        // console.log(\"doing work for filling containers\")\r\n        this.harvest();\r\n    };\r\n    FillContainers.prototype.harvest = function () {\r\n        var creep = Game.creeps[this.request.assignedTo];\r\n        if (creep.carry.energy == creep.carryCapacity) {\r\n            this.deliver();\r\n            return;\r\n        }\r\n        var request = this.request;\r\n        var source = Game.getObjectById(request.targetID);\r\n        if (creep.harvest(source) == ERR_NOT_IN_RANGE) {\r\n            creep.moveTo(source, { visualizePathStyle: { stroke: '#ffaa00' } });\r\n        }\r\n    };\r\n    FillContainers.prototype.deliver = function () {\r\n        var creep = Game.creeps[this.request.assignedTo];\r\n        var container = RoomManager.FindClosestContainer(this.request.roomName, creep.id, false);\r\n        if (container == undefined)\r\n            throw \"Error!\";\r\n        if (creep.transfer(container, RESOURCE_ENERGY) == ERR_NOT_IN_RANGE) {\r\n            creep.moveTo(container, { visualizePathStyle: { stroke: '#ffffff' } });\r\n        }\r\n    };\r\n    FillContainers.addTasks = function (roomName) {\r\n        // console.log(\"Fill containers start\")\r\n        var room = Game.rooms[roomName];\r\n        var sources = Game.rooms[room.name].find(FIND_SOURCES_ACTIVE);\r\n        if (sources.length == 0)\r\n            return;\r\n        // console.log(\"sources: \" + sources.length)\r\n        for (var id in sources) {\r\n            var source = sources[id];\r\n            var request = new FillContainersRequest(roomName, source.id);\r\n            if (CreepTaskQueue.totalCount(roomName, request.name) < request.maxConcurrentCount) {\r\n                // console.log(\"adding fill task\")\r\n                CreepTaskQueue.addPending(request);\r\n            }\r\n        }\r\n    };\r\n    return FillContainers;\r\n}(CreepTask));\r\nexport { FillContainers };\r\n//# sourceMappingURL=FillContainers.js.map","map":{"version":3,"file":"FillContainers.js","sourceRoot":"","sources":["../../src/tasks/creep/FillContainers.ts"],"names":[],"mappings":"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"}}
