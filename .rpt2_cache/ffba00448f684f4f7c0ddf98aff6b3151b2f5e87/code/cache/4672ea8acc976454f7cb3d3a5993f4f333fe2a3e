{"code":"import { RoomManager } from \"RoomManager\";\r\nvar WorkerTaskInfo = /** @class */ (function () {\r\n    function WorkerTaskInfo(roomName) {\r\n        this.name = \"name me\";\r\n        this.started = false;\r\n        this.finished = false;\r\n        this.assignedCreepName = \"\";\r\n        this.roomName = \"\";\r\n        this.maxConcurrentCount = -1;\r\n        this.wingDing = \"\\uD83D\\uDEE9\";\r\n        this.roomName = roomName;\r\n    }\r\n    return WorkerTaskInfo;\r\n}());\r\nexport { WorkerTaskInfo };\r\nvar WorkerTask = /** @class */ (function () {\r\n    function WorkerTask(taskInfo) {\r\n        this.taskInfo = taskInfo;\r\n    }\r\n    WorkerTask.prototype.start = function () {\r\n        this.taskInfo.started = true;\r\n        this.taskInfo.finished = false;\r\n        var creep = Game.creeps[this.taskInfo.assignedCreepName];\r\n        console.log(creep.name + \" is starting its \" + this.taskInfo.name + \" task.\");\r\n        var creepMem = creep.memory;\r\n        creepMem.currentTask = this.taskInfo.name;\r\n        creepMem.idle = false;\r\n        if (creep.carry.energy < creep.carryCapacity / 2) {\r\n            creepMem.preppingForTask = true;\r\n        }\r\n    };\r\n    WorkerTask.prototype.continue = function () {\r\n        var creep = Game.creeps[this.taskInfo.assignedCreepName];\r\n        if (creep === undefined || creep.memory === undefined || this.taskInfo.assignedCreepName == \"\") {\r\n            console.log(\"cant continue, don't have a creep. - completing task.\");\r\n            this.taskInfo.finished = true;\r\n            return;\r\n        }\r\n        //console.log(creep.name + \" is continuing its \" + this.taskInfo.name + \" task.\")\r\n        if (this.taskInfo.finished) {\r\n            console.log(\"task was finished...\" + creep.name);\r\n            return;\r\n        }\r\n        var creepMemory = creep.memory;\r\n        if (creep.carry.energy == 0) {\r\n            creepMemory.preppingForTask = true;\r\n        }\r\n        if (creepMemory.preppingForTask) {\r\n            creepMemory.preppingForTask = true;\r\n            this.collect(this.taskInfo.roomName, creep.id, function () { });\r\n        }\r\n        else {\r\n            this.moveoutdaway();\r\n            this.doWork();\r\n        }\r\n    };\r\n    WorkerTask.prototype.finish = function () {\r\n        var creep = Game.creeps[this.taskInfo.assignedCreepName];\r\n        if (creep !== undefined) {\r\n            creep.say(\"ðŸš§Finished!\");\r\n            var mem = creep.memory;\r\n            mem.idle = true;\r\n            mem.preppingForTask = false;\r\n            mem.currentTask = \"\";\r\n            console.log(creep.name + \" is finishing its \" + this.taskInfo.name + \" task.\");\r\n        }\r\n        this.taskInfo.finished = true;\r\n    };\r\n    WorkerTask.prototype.moveoutdaway = function () {\r\n        var roomMem = Game.rooms[this.taskInfo.roomName].memory;\r\n        var creep = Game.creeps[this.taskInfo.assignedCreepName];\r\n        var harvestLocs = roomMem.harvestLocations;\r\n        var creepMem = creep.memory;\r\n        if (creepMem.preppingForTask)\r\n            return;\r\n        for (var id in harvestLocs) {\r\n            var loc = harvestLocs[id];\r\n            if (creep.pos.getRangeTo(loc.pos.x, loc.pos.y) < 1) {\r\n                //creep.say(\"moving!\")\r\n                creep.moveTo(Game.getObjectById(creepMem.spawnID));\r\n            }\r\n        }\r\n    };\r\n    WorkerTask.prototype.announce = function (creepID) {\r\n        if (Game.time % 10 == 0) {\r\n            var creep = Game.getObjectById(creepID);\r\n            creep.say(this.taskInfo.wingDing);\r\n        }\r\n    };\r\n    WorkerTask.prototype.collect = function (roomName, creepID, energyFullCallback) {\r\n        var creep = Game.getObjectById(creepID);\r\n        var mem = creep.memory;\r\n        var closestSpot = RoomManager.GetClosestOrAssignedHarvestLocation(roomName, creepID);\r\n        if (creep.carry.energy < creep.carryCapacity) {\r\n            if (Game.time % 5 == 0) {\r\n                creep.say(\"\\uD83D\\uDD04\" + this.taskInfo.wingDing);\r\n            }\r\n            if (closestSpot != undefined) {\r\n                var source = Game.getObjectById(closestSpot.sourceID);\r\n                if (creep.pos.getRangeTo(closestSpot.pos.x, closestSpot.pos.y) > 0) {\r\n                    creep.moveTo(closestSpot.pos.x, closestSpot.pos.y, { visualizePathStyle: { stroke: '#ffaa00' } });\r\n                }\r\n                else {\r\n                    creep.harvest(source);\r\n                    if (source.energy == 0) {\r\n                        mem.preppingForTask = false;\r\n                        if (closestSpot != undefined) {\r\n                            closestSpot.assignedTo = null;\r\n                        }\r\n                        energyFullCallback();\r\n                    }\r\n                }\r\n            }\r\n            else {\r\n                creep.say(\"\\u231B\");\r\n                var home = Game.getObjectById(mem.spawnID);\r\n                creep.moveTo(home.pos.x, home.pos.y);\r\n            }\r\n        }\r\n        else {\r\n            //console.log (closestSpot.assignedTo + \" has been unassigned.\")\r\n            mem.preppingForTask = false;\r\n            if (closestSpot != undefined) {\r\n                closestSpot.assignedTo = null;\r\n            }\r\n            energyFullCallback();\r\n        }\r\n    };\r\n    return WorkerTask;\r\n}());\r\nexport { WorkerTask };\r\n//# sourceMappingURL=WorkerTask.js.map","map":{"version":3,"file":"WorkerTask.js","sourceRoot":"","sources":["../src/abstract/WorkerTask.ts"],"names":[],"mappings":"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"}}
