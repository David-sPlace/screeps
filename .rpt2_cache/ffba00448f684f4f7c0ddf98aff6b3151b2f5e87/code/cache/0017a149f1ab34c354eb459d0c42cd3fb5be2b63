{"code":"import * as tslib_1 from \"tslib\";\r\nimport { WorkerTask, WorkerTaskInfo } from \"abstract/workerTask\";\r\nimport { WorkerTaskQueue } from \"utils/TaskQueue\";\r\nvar BuildTaskInfo = /** @class */ (function (_super) {\r\n    tslib_1.__extends(BuildTaskInfo, _super);\r\n    function BuildTaskInfo(roomName, siteID) {\r\n        var _this = _super.call(this, roomName) || this;\r\n        _this.wingDing = \"\\uD83D\\uDEA7\";\r\n        _this.name = \"Build\";\r\n        _this.maxConcurrentCount = 4;\r\n        _this.siteID = siteID;\r\n        return _this;\r\n    }\r\n    return BuildTaskInfo;\r\n}(WorkerTaskInfo));\r\nexport { BuildTaskInfo };\r\nvar RepairTaskInfo = /** @class */ (function (_super) {\r\n    tslib_1.__extends(RepairTaskInfo, _super);\r\n    function RepairTaskInfo(roomName, siteID) {\r\n        var _this = _super.call(this, roomName) || this;\r\n        _this.wingDing = \"\\uD83D\\uDEA7\";\r\n        _this.name = \"Repair\";\r\n        _this.maxConcurrentCount = 3;\r\n        _this.siteID = siteID;\r\n        return _this;\r\n    }\r\n    RepairTaskInfo.maxHitPoints = 500000;\r\n    return RepairTaskInfo;\r\n}(WorkerTaskInfo));\r\nexport { RepairTaskInfo };\r\nvar RepairTask = /** @class */ (function (_super) {\r\n    tslib_1.__extends(RepairTask, _super);\r\n    function RepairTask(taskInfo) {\r\n        var _this = _super.call(this, taskInfo) || this;\r\n        _this.taskInfo = taskInfo;\r\n        return _this;\r\n    }\r\n    RepairTask.addRepairTask = function (roomName) {\r\n        var room = Game.rooms[roomName];\r\n        var targets = room.find(FIND_STRUCTURES)\r\n            .filter(function (structure) { return structure.hits < structure.hitsMax * .9 && structure.hits < RepairTaskInfo.maxHitPoints; })\r\n            .sort(function (a, b) { return a.hits - b.hits; });\r\n        //console.log(\"repair targets: \" + targets.length)\r\n        targets.sort(function (a, b) { return a.hits - b.hits; });\r\n        for (var id in targets) {\r\n            var thing = targets[id];\r\n            var taskInfo = new RepairTaskInfo(roomName, thing.id);\r\n            var existingTaskCount = WorkerTaskQueue.totalCount(roomName, taskInfo.name);\r\n            if (existingTaskCount < taskInfo.maxConcurrentCount) {\r\n                WorkerTaskQueue.addPendingTask(taskInfo, roomName);\r\n            }\r\n        }\r\n    };\r\n    RepairTask.prototype.doWork = function () {\r\n        var site = Game.getObjectById(this.taskInfo.siteID);\r\n        var creep = Game.creeps[this.taskInfo.assignedCreepName];\r\n        if (site != undefined) {\r\n            if (creep.repair(site) == ERR_NOT_IN_RANGE) {\r\n                creep.moveTo(site, { visualizePathStyle: { stroke: '#ffffff' } });\r\n                creep.say('ðŸ› ');\r\n            }\r\n            if (site.hitsMax == site.hits || site.hits > RepairTaskInfo.maxHitPoints) {\r\n                this.taskInfo.finished = true;\r\n                return;\r\n            }\r\n        }\r\n        else\r\n            this.taskInfo.finished = true;\r\n    };\r\n    return RepairTask;\r\n}(WorkerTask));\r\nexport { RepairTask };\r\nvar BuildTask = /** @class */ (function (_super) {\r\n    tslib_1.__extends(BuildTask, _super);\r\n    function BuildTask(taskInfo) {\r\n        var _this = _super.call(this, taskInfo) || this;\r\n        _this.taskInfo = taskInfo;\r\n        return _this;\r\n    }\r\n    BuildTask.prototype.doWork = function () {\r\n        var site = Game.getObjectById(this.taskInfo.siteID);\r\n        var creep = Game.creeps[this.taskInfo.assignedCreepName];\r\n        var creepMemory = creep.memory;\r\n        if (site == null || creep == undefined) {\r\n            this.taskInfo.finished = true;\r\n            return;\r\n        }\r\n        var progressLeft = site.progressTotal - site.progress;\r\n        if (progressLeft == 0) {\r\n            this.taskInfo.finished = true;\r\n            return;\r\n        }\r\n        if (creep.build(site) == ERR_NOT_IN_RANGE) {\r\n            creep.moveTo(site, { visualizePathStyle: { stroke: '#ffffff' } });\r\n        }\r\n        if (creep.carry.energy == 0) {\r\n            creepMemory.preppingForTask = true;\r\n        }\r\n    };\r\n    BuildTask.addBuildTasks = function (roomName) {\r\n        var room = Game.rooms[roomName];\r\n        var sites = room.find(FIND_CONSTRUCTION_SITES);\r\n        _.each(sites, function (site) {\r\n            var taskInfo = new BuildTaskInfo(roomName, site.id);\r\n            var existingTaskCount = WorkerTaskQueue.totalCount(roomName, taskInfo.name);\r\n            if (site.progressTotal > 0 && existingTaskCount < taskInfo.maxConcurrentCount) {\r\n                console.log(\"Adding a construction task to worker queue.\");\r\n                WorkerTaskQueue.addPendingTask(taskInfo, roomName);\r\n            }\r\n        });\r\n    };\r\n    return BuildTask;\r\n}(WorkerTask));\r\nexport { BuildTask };\r\n//# sourceMappingURL=BuildTask.js.map","map":{"version":3,"file":"BuildTask.js","sourceRoot":"","sources":["../src/tasks/BuildTask.ts"],"names":[],"mappings":";AAAA,OAAO,EAAE,UAAU,EAAE,cAAc,EAAE,MAAM,qBAAqB,CAAC;AAEjE,OAAO,EAAE,eAAe,EAAE,MAAM,iBAAiB,CAAC;AAElD;IAAmC,yCAAc;IAOhD,uBAAY,QAAgB,EAAE,MAAc;QAA5C,YAEC,kBAAM,QAAQ,CAAC,SAEf;QARD,cAAQ,GAAG,cAAI,CAAC;QAChB,UAAI,GAAG,OAAO,CAAC;QACf,wBAAkB,GAAG,CAAC,CAAC;QAKtB,KAAI,CAAC,MAAM,GAAG,MAAM,CAAC;;IACtB,CAAC;IACF,oBAAC;AAAD,CAAC,AAZD,CAAmC,cAAc,GAYhD;;AACD;IAAoC,0CAAc;IAOjD,wBAAY,QAAgB,EAAE,MAAc;QAA5C,YAEC,kBAAM,QAAQ,CAAC,SAEf;QATD,cAAQ,GAAG,cAAI,CAAC;QAChB,UAAI,GAAG,QAAQ,CAAC;QAChB,wBAAkB,GAAG,CAAC,CAAC;QAMtB,KAAI,CAAC,MAAM,GAAG,MAAM,CAAC;;IACtB,CAAC;IANM,2BAAY,GAAG,MAAM,CAAC;IAO9B,qBAAC;CAAA,AAZD,CAAoC,cAAc,GAYjD;SAZY,cAAc;AAa3B;IAAgC,sCAAU;IAIzC,oBAAY,QAAwB;QAApC,YAEC,kBAAM,QAA0B,CAAC,SAEjC;QADA,KAAI,CAAC,QAAQ,GAAG,QAAQ,CAAC;;IAC1B,CAAC;IACM,wBAAa,GAApB,UAAqB,QAAgB;QAEpC,IAAI,IAAI,GAAG,IAAI,CAAC,KAAK,CAAC,QAAQ,CAAC,CAAC;QAChC,IAAM,OAAO,GAAG,IAAI,CAAC,IAAI,CAAC,eAAe,CAAC;aACzC,MAAM,CAAC,UAAA,SAAS,IAAI,OAAA,SAAS,CAAC,IAAI,GAAG,SAAS,CAAC,OAAO,GAAC,EAAE,IAAI,SAAS,CAAC,IAAI,GAAG,cAAc,CAAC,YAAY,EAArF,CAAqF,CAAC;aAC1G,IAAI,CAAC,UAAC,CAAC,EAAC,CAAC,IAAK,OAAA,CAAC,CAAC,IAAI,GAAG,CAAC,CAAC,IAAI,EAAf,CAAe,CAAC,CAAC;QAEhC,kDAAkD;QAClD,OAAO,CAAC,IAAI,CAAC,UAAC,CAAC,EAAE,CAAC,IAAK,OAAA,CAAC,CAAC,IAAI,GAAG,CAAC,CAAC,IAAI,EAAf,CAAe,CAAC,CAAC;QAExC,KAAK,IAAM,EAAE,IAAI,OAAO,EACxB;YACC,IAAI,KAAK,GAAG,OAAO,CAAC,EAAE,CAAC,CAAC;YACxB,IAAI,QAAQ,GAAG,IAAI,cAAc,CAAC,QAAQ,EAAE,KAAK,CAAC,EAAE,CAAC,CAAC;YACtD,IAAI,iBAAiB,GAAG,eAAe,CAAC,UAAU,CAAC,QAAQ,EAAE,QAAQ,CAAC,IAAI,CAAC,CAAC;YAE5E,IAAI,iBAAiB,GAAG,QAAQ,CAAC,kBAAkB,EACnD;gBACC,eAAe,CAAC,cAAc,CAAC,QAAQ,EAAE,QAAQ,CAAC,CAAC;aACnD;SACD;IAEF,CAAC;IACD,2BAAM,GAAN;QAEC,IAAI,IAAI,GAAG,IAAI,CAAC,aAAa,CAAC,IAAI,CAAC,QAAQ,CAAC,MAAM,CAAiB,CAAC;QACpE,IAAI,KAAK,GAAG,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,QAAQ,CAAC,iBAAiB,CAAU,CAAC;QAElE,IAAI,IAAI,IAAI,SAAS,EACrB;YACC,IAAI,KAAK,CAAC,MAAM,CAAC,IAAI,CAAC,IAAI,gBAAgB,EAC1C;gBACC,KAAK,CAAC,MAAM,CAAC,IAAI,EAAE,EAAE,kBAAkB,EAAE,EAAE,MAAM,EAAE,SAAS,EAAE,EAAE,CAAC,CAAC;gBAClE,KAAK,CAAC,GAAG,CAAC,IAAI,CAAC,CAAC;aAChB;YACD,IAAI,IAAI,CAAC,OAAO,IAAI,IAAI,CAAC,IAAI,IAAI,IAAI,CAAC,IAAI,GAAG,cAAc,CAAC,YAAY,EACxE;gBACC,IAAI,CAAC,QAAQ,CAAC,QAAQ,GAAG,IAAI,CAAC;gBAC9B,OAAO;aACP;SACD;;YACI,IAAI,CAAC,QAAQ,CAAC,QAAQ,GAAG,IAAI,CAAC;IAEpC,CAAC;IACF,iBAAC;AAAD,CAAC,AArDD,CAAgC,UAAU,GAqDzC;;AACD;IAA+B,qCAAU;IAGxC,mBAAY,QAAuB;QAAnC,YAEC,kBAAM,QAA0B,CAAC,SAEjC;QADA,KAAI,CAAC,QAAQ,GAAG,QAAQ,CAAC;;IAC1B,CAAC;IAED,0BAAM,GAAN;QAGC,IAAI,IAAI,GAAG,IAAI,CAAC,aAAa,CAAC,IAAI,CAAC,QAAQ,CAAC,MAAM,CAAqB,CAAC;QACxE,IAAI,KAAK,GAAG,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,QAAQ,CAAC,iBAAiB,CAAU,CAAC;QAClE,IAAI,WAAW,GAAG,KAAK,CAAC,MAAqB,CAAC;QAC9C,IAAI,IAAI,IAAI,IAAI,IAAI,KAAK,IAAI,SAAS,EACtC;YACC,IAAI,CAAC,QAAQ,CAAC,QAAQ,GAAG,IAAI,CAAC;YAC9B,OAAO;SACP;QACD,IAAI,YAAY,GAAG,IAAI,CAAC,aAAa,GAAG,IAAI,CAAC,QAAQ,CAAC;QACtD,IAAI,YAAY,IAAI,CAAC,EACrB;YACC,IAAI,CAAC,QAAQ,CAAC,QAAQ,GAAG,IAAI,CAAC;YAC9B,OAAO;SACP;QAED,IAAI,KAAK,CAAC,KAAK,CAAC,IAAI,CAAC,IAAI,gBAAgB,EACzC;YACC,KAAK,CAAC,MAAM,CAAC,IAAI,EAAE,EAAE,kBAAkB,EAAE,EAAE,MAAM,EAAE,SAAS,EAAE,EAAE,CAAC,CAAC;SAClE;QACD,IAAI,KAAK,CAAC,KAAK,CAAC,MAAM,IAAI,CAAC,EAC3B;YACC,WAAW,CAAC,eAAe,GAAG,IAAI,CAAC;SACnC;IAEF,CAAC;IACM,uBAAa,GAApB,UAAqB,QAAgB;QAEpC,IAAI,IAAI,GAAG,IAAI,CAAC,KAAK,CAAC,QAAQ,CAAC,CAAC;QAChC,IAAI,KAAK,GAAG,IAAI,CAAC,IAAI,CAAC,uBAAuB,CAAC,CAAC;QAE/C,CAAC,CAAC,IAAI,CAAC,KAAK,EAAE,UAAA,IAAI;YAEjB,IAAI,QAAQ,GAAG,IAAI,aAAa,CAAC,QAAQ,EAAE,IAAI,CAAC,EAAE,CAAC,CAAC;YACpD,IAAI,iBAAiB,GAAG,eAAe,CAAC,UAAU,CAAC,QAAQ,EAAE,QAAQ,CAAC,IAAI,CAAC,CAAC;YAE5E,IAAI,IAAI,CAAC,aAAa,GAAG,CAAC,IAAI,iBAAiB,GAAG,QAAQ,CAAC,kBAAkB,EAC7E;gBACC,OAAO,CAAC,GAAG,CAAC,6CAA6C,CAAC,CAAC;gBAC3D,eAAe,CAAC,cAAc,CAAC,QAAQ,EAAE,QAAQ,CAAC,CAAC;aACnD;QAEF,CAAC,CAAC,CAAA;IACH,CAAC;IAEF,gBAAC;AAAD,CAAC,AAxDD,CAA+B,UAAU,GAwDxC"}}
