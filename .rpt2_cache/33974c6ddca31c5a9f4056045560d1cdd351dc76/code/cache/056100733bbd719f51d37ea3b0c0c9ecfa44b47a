{"code":"import * as tslib_1 from \"tslib\";\r\nimport { CreepTask } from \"../CreepTask\";\r\nimport { CreepTaskRequest } from \"../CreepTaskRequest\";\r\nimport { CreepTaskQueue } from \"../CreepTaskQueue\";\r\nimport * as utils from \"utils/utils\";\r\nvar PickUpEnergyRequest = /** @class */ (function (_super) {\r\n    tslib_1.__extends(PickUpEnergyRequest, _super);\r\n    function PickUpEnergyRequest(roomName, resourceID, resourceType) {\r\n        var _this = _super.call(this, roomName, \"😍\", resourceID) || this;\r\n        _this.priority = .9;\r\n        _this.name = \"PickupEnergy\";\r\n        _this.requiredRole = 3 /* ROLE_WORKER */;\r\n        _this.maxConcurrentCount = 1;\r\n        _this.resourceType = resourceType;\r\n        return _this;\r\n    }\r\n    return PickUpEnergyRequest;\r\n}(CreepTaskRequest));\r\nexport { PickUpEnergyRequest };\r\nvar PickupEnergy = /** @class */ (function (_super) {\r\n    tslib_1.__extends(PickupEnergy, _super);\r\n    function PickupEnergy(taskInfo) {\r\n        return _super.call(this, taskInfo) || this;\r\n    }\r\n    PickupEnergy.prototype.continue = function () {\r\n        var creep = Game.creeps[this.request.assignedTo];\r\n        if (this.request.assignedTo == \"\" || creep === undefined || creep.memory === undefined) {\r\n            this.request.finished = true;\r\n            return;\r\n        }\r\n        if (Game.time % 5 == 0) {\r\n            creep.say(\"\" + this.request.wingDing);\r\n        }\r\n        this.doWork();\r\n    };\r\n    PickupEnergy.prototype.doWork = function () {\r\n        var requestInfo = this.request;\r\n        var resource = Game.getObjectById(this.request.targetID);\r\n        var creep = Game.creeps[this.request.assignedTo];\r\n        if (resource == null || creep.carry.energy == creep.carryCapacity) {\r\n            this.request.finished = true;\r\n            return;\r\n        }\r\n        // if (requestInfo.resourceType == \"tombstone\")\r\n        // {\r\n        // \tvar tombstone = resource as Tombstone;\r\n        // \tif (creep.withdraw(tombstone, RESOURCE_ENERGY) == ERR_NOT_IN_RANGE)\r\n        // \t{\r\n        // \t\tcreep.moveTo(tombstone);\r\n        // \t}\r\n        // \telse\r\n        // \t{\r\n        // \t\tthis.request.finished = true;\r\n        // \t\treturn;\r\n        // \t}\r\n        // }\r\n        else if (requestInfo.resourceType == \"resource\") {\r\n            var droppedResource = resource;\r\n            if (creep.pickup(droppedResource) == ERR_NOT_IN_RANGE) {\r\n                creep.moveTo(droppedResource);\r\n            }\r\n            else {\r\n                this.deliver();\r\n                if (creep.carry.energy == 0) {\r\n                    this.request.finished = true;\r\n                    return;\r\n                }\r\n            }\r\n        }\r\n    };\r\n    PickupEnergy.prototype.deliver = function () {\r\n        var creep = Game.creeps[this.request.assignedTo];\r\n        var container = utils.findClosestContainer(this.request.roomName, creep.id, false, true);\r\n        if (container == undefined)\r\n            throw \"Error!\";\r\n        if (container.store.energy == container.storeCapacity) {\r\n            //this.request.finished = true;\r\n            return;\r\n        }\r\n        if (creep.transfer(container, RESOURCE_ENERGY) == ERR_NOT_IN_RANGE) {\r\n            creep.moveTo(container, { visualizePathStyle: { stroke: '#ffffff' } });\r\n        }\r\n    };\r\n    PickupEnergy.addTasks = function (roomName) {\r\n        var room = Game.rooms[roomName];\r\n        var resources = room.find(FIND_DROPPED_RESOURCES);\r\n        //var tombstones = room.find(FIND_TOMBSTONES) as Tombstone[];\r\n        //var totalCount = tombstones.length;\r\n        var totalCount = resources.length;\r\n        //var totalCount = resources.length + tombstones.length;\r\n        if (resources.length > 0) {\r\n            for (var key in resources) {\r\n                if (resources.hasOwnProperty(key)) {\r\n                    var resource = resources[key];\r\n                    if (resource.resourceType == RESOURCE_ENERGY) {\r\n                        var droppedReq = new PickUpEnergyRequest(roomName, resource.id, \"resource\");\r\n                        var existingTaskCount = CreepTaskQueue.totalCount(roomName, droppedReq.name);\r\n                        //console.log(\"existing : \" + existingTaskCount)\r\n                        //console.log(\"max : \" + droppedReq.maxConcurrentCount)\r\n                        if (CreepTaskQueue.totalCount(roomName, droppedReq.name) < droppedReq.maxConcurrentCount) {\r\n                            CreepTaskQueue.addPending(droppedReq);\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n        }\r\n        // if (tombstones.length > 0)\r\n        // {\r\n        // \tfor (const key in tombstones)\r\n        // \t{\r\n        // \t\tif (tombstones.hasOwnProperty(key))\r\n        // \t\t{\r\n        // \t\t\tconst tombstone = tombstones[key] as Tombstone;\r\n        // \t\t\tif (tombstone.store.energy > 0)\r\n        // \t\t\t{\r\n        // \t\t\t\tvar tombReq = new PickUpEnergyRequest(roomName, tombstone.id, \"tombstone\")\r\n        // \t\t\t\tif (CreepTaskQueue.totalCount(roomName, tombReq.name) < tombReq.maxConcurrentCount)\r\n        // \t\t\t\t{\r\n        // \t\t\t\t\tCreepTaskQueue.addPending(tombReq);\r\n        // \t\t\t\t}\r\n        // \t\t\t}\r\n        // \t\t}\r\n        // \t}\r\n        // }\r\n    };\r\n    return PickupEnergy;\r\n}(CreepTask));\r\nexport { PickupEnergy };\r\n//# sourceMappingURL=PickupEnergy.js.map","map":{"version":3,"file":"PickupEnergy.js","sourceRoot":"","sources":["../../src/tasks/creep/PickupEnergy.ts"],"names":[],"mappings":"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"}}
