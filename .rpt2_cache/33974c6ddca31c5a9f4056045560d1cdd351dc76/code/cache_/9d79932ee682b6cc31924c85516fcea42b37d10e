{"code":"import * as tslib_1 from \"tslib\";\r\nimport { StructureTask } from \"tasks/StructureTask\";\r\nimport { StructureTaskRequest } from \"tasks/StructureTaskRequest\";\r\nimport { StructureTaskQueue } from \"tasks/StructureTaskQueue\";\r\nvar TowerRepairRequest = /** @class */ (function (_super) {\r\n    tslib_1.__extends(TowerRepairRequest, _super);\r\n    function TowerRepairRequest(roomName, siteID) {\r\n        var _this = _super.call(this, roomName, siteID) || this;\r\n        _this.priority = 2;\r\n        _this.name = \"TowerRepair\";\r\n        _this.maxConcurrentCount = 5;\r\n        return _this;\r\n    }\r\n    TowerRepairRequest.maxHitPoints = 1000000;\r\n    return TowerRepairRequest;\r\n}(StructureTaskRequest));\r\nexport { TowerRepairRequest };\r\nvar TowerRepair = /** @class */ (function (_super) {\r\n    tslib_1.__extends(TowerRepair, _super);\r\n    function TowerRepair(taskInfo) {\r\n        return _super.call(this, taskInfo) || this;\r\n    }\r\n    TowerRepair.prototype.doWork = function () {\r\n        if (Game.time % 4 != 0)\r\n            return;\r\n        var info = this.request;\r\n        var site = Game.getObjectById(info.targetID);\r\n        // if(site.structureType == \"rampart\")  console.log(\"got a rampart!\");\r\n        var tower = Game.getObjectById(info.assignedTo);\r\n        //console.log(\"Tower: \" + tower.structureType + \" \" + tower.owner)\r\n        if (tower == null || site == null) {\r\n            console.log(\"something went wrong\");\r\n        }\r\n        if (site.hits == site.hitsMax || tower.energy < tower.energyCapacity * .5) {\r\n            this.request.finished = true;\r\n            return;\r\n        }\r\n        tower.repair(site);\r\n    };\r\n    TowerRepair.addTask = function (roomName) {\r\n        var room = Game.rooms[roomName];\r\n        var targets = room.find(FIND_STRUCTURES)\r\n            .filter(function (structure) { return structure.hits < structure.hitsMax * .75 && structure.hits < TowerRepairRequest.maxHitPoints; })\r\n            .sort(function (a, b) { return a.hits - b.hits; });\r\n        for (var id in targets) {\r\n            var thing = targets[id];\r\n            var request = new TowerRepairRequest(roomName, thing.id);\r\n            var existingTaskCount = StructureTaskQueue.totalCount(roomName, request.name);\r\n            if (existingTaskCount < request.maxConcurrentCount) {\r\n                StructureTaskQueue.addPending(request, roomName);\r\n            }\r\n        }\r\n    };\r\n    return TowerRepair;\r\n}(StructureTask));\r\nexport { TowerRepair };\r\n//# sourceMappingURL=TowerRepair.js.map","map":{"version":3,"file":"TowerRepair.js","sourceRoot":"","sources":["../../src/tasks/structure/TowerRepair.ts"],"names":[],"mappings":";AAAA,OAAO,EAAE,aAAa,EAAE,MAAM,qBAAqB,CAAC;AACpD,OAAO,EAAE,oBAAoB,EAAE,MAAM,4BAA4B,CAAC;AAClE,OAAO,EAAE,kBAAkB,EAAE,MAAM,0BAA0B,CAAC;AAG9D;IAAwC,8CAAoB;IAM3D,4BAAY,QAAgB,EAAE,MAAa;QAA3C,YACC,kBAAM,QAAQ,EAAE,MAAM,CAAC,SACvB;QAND,cAAQ,GAAW,CAAC,CAAC;QACrB,UAAI,GAAW,aAAa,CAAC;QAC7B,wBAAkB,GAAW,CAAC,CAAC;;IAI/B,CAAC;IAHM,+BAAY,GAAW,OAAO,CAAC;IAKvC,yBAAC;CAAA,AAVD,CAAwC,oBAAoB,GAU3D;SAVY,kBAAkB;AAW/B;IAAiC,uCAAa;IAkB7C,qBAAY,QAA8B;eACzC,kBAAM,QAAQ,CAAC;IAChB,CAAC;IAnBS,4BAAM,GAAhB;QAEC,IAAG,IAAI,CAAC,IAAI,GAAG,CAAC,IAAI,CAAC;YAAE,OAAO;QAC9B,IAAI,IAAI,GAAG,IAAI,CAAC,OAA6B,CAAC;QAC9C,IAAI,IAAI,GAAG,IAAI,CAAC,aAAa,CAAC,IAAI,CAAC,QAAQ,CAAiB,CAAC;QAC7D,sEAAsE;QACtE,IAAI,KAAK,GAAG,IAAI,CAAC,aAAa,CAAC,IAAI,CAAC,UAAU,CAAmB,CAAC;QAClE,kEAAkE;QAClE,IAAG,KAAK,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,EAAC;YAChC,OAAO,CAAC,GAAG,CAAC,sBAAsB,CAAC,CAAA;SACnC;QACD,IAAG,IAAI,CAAC,IAAI,IAAI,IAAI,CAAC,OAAO,IAAI,KAAK,CAAC,MAAM,GAAG,KAAK,CAAC,cAAc,GAAC,EAAE,EAAC;YACtE,IAAI,CAAC,OAAO,CAAC,QAAQ,GAAG,IAAI,CAAC;YAC7B,OAAO;SACP;QACD,KAAK,CAAC,MAAM,CAAC,IAAI,CAAC,CAAC;IACpB,CAAC;IAIM,mBAAO,GAAd,UAAe,QAAgB;QAC9B,IAAI,IAAI,GAAG,IAAI,CAAC,KAAK,CAAC,QAAQ,CAAC,CAAC;QAChC,IAAM,OAAO,GAAG,IAAI,CAAC,IAAI,CAAC,eAAe,CAAC;aACzC,MAAM,CAAC,UAAA,SAAS,IAAI,OAAA,SAAS,CAAC,IAAI,GAAG,SAAS,CAAC,OAAO,GAAE,GAAG,IAAI,SAAS,CAAC,IAAI,GAAG,kBAAkB,CAAC,YAAY,EAA3F,CAA2F,CAAC;aAChH,IAAI,CAAC,UAAC,CAAC,EAAC,CAAC,IAAK,OAAA,CAAC,CAAC,IAAI,GAAG,CAAC,CAAC,IAAI,EAAf,CAAe,CAAC,CAAC;QAEhC,KAAK,IAAM,EAAE,IAAI,OAAO,EACxB;YACC,IAAI,KAAK,GAAG,OAAO,CAAC,EAAE,CAAC,CAAC;YACxB,IAAI,OAAO,GAAG,IAAI,kBAAkB,CAAC,QAAQ,EAAE,KAAK,CAAC,EAAE,CAAC,CAAC;YAEzD,IAAI,iBAAiB,GAAG,kBAAkB,CAAC,UAAU,CAAC,QAAQ,EAAE,OAAO,CAAC,IAAI,CAAC,CAAC;YAE9E,IAAI,iBAAiB,GAAG,OAAO,CAAC,kBAAkB,EAClD;gBACC,kBAAkB,CAAC,UAAU,CAAC,OAAO,EAAE,QAAQ,CAAC,CAAC;aACjD;SACD;IACF,CAAC;IACF,kBAAC;AAAD,CAAC,AAxCD,CAAiC,aAAa,GAwC7C"}}
