{"code":"import * as tslib_1 from \"tslib\";\r\nimport { StructureTask, StructureTaskInfo } from \"abstract/WorkerTask\";\r\nimport { StructureTaskQueue } from \"utils/taskQueue\";\r\nvar TowerRepairTaskInfo = /** @class */ (function (_super) {\r\n    tslib_1.__extends(TowerRepairTaskInfo, _super);\r\n    function TowerRepairTaskInfo(roomName, siteID) {\r\n        var _this = _super.call(this, roomName, siteID) || this;\r\n        _this.name = \"TowerRepair\";\r\n        _this.maxConcurrentCount = 5;\r\n        return _this;\r\n    }\r\n    TowerRepairTaskInfo.maxHitPoints = 500000;\r\n    return TowerRepairTaskInfo;\r\n}(StructureTaskInfo));\r\nexport { TowerRepairTaskInfo };\r\nvar TowerAttackTaskInfo = /** @class */ (function (_super) {\r\n    tslib_1.__extends(TowerAttackTaskInfo, _super);\r\n    function TowerAttackTaskInfo(roomName, hostileID) {\r\n        var _this = _super.call(this, roomName, hostileID) || this;\r\n        _this.name = \"TowerAttack\";\r\n        _this.maxConcurrentCount = 100;\r\n        _this.hostileID = hostileID;\r\n        return _this;\r\n    }\r\n    return TowerAttackTaskInfo;\r\n}(StructureTaskInfo));\r\nexport { TowerAttackTaskInfo };\r\nvar TowerAttack = /** @class */ (function (_super) {\r\n    tslib_1.__extends(TowerAttack, _super);\r\n    function TowerAttack(taskInfo) {\r\n        return _super.call(this, taskInfo) || this;\r\n    }\r\n    TowerAttack.prototype.doWork = function () {\r\n        var info = this.taskInfo;\r\n        var hostile = Game.getObjectById(info.hostileID);\r\n        // if(site.structureType == \"rampart\")  console.log(\"got a rampart!\");\r\n        var tower = Game.getObjectById(info.assignedTo);\r\n        //console.log(\"Tower: \" + tower.structureType + \" \" + tower.owner)\r\n        if (tower == null || hostile == undefined || hostile.hits == 0) {\r\n            this.taskInfo.finished = true;\r\n            return;\r\n        }\r\n        tower.attack(hostile);\r\n    };\r\n    TowerAttack.addTask = function (roomName) {\r\n        var room = Game.rooms[roomName];\r\n        var targets = room.find(FIND_HOSTILE_CREEPS)\r\n            .sort(function (a, b) { return a.hits - b.hits; });\r\n        for (var id in targets) {\r\n            var thing = targets[id];\r\n            var taskInfo = new TowerAttackTaskInfo(roomName, thing.id);\r\n            if (StructureTaskQueue.totalCount(roomName, taskInfo.name) < taskInfo.maxConcurrentCount) {\r\n                StructureTaskQueue.addPending(taskInfo, roomName);\r\n            }\r\n        }\r\n    };\r\n    return TowerAttack;\r\n}(StructureTask));\r\nexport { TowerAttack };\r\nvar TowerRepair = /** @class */ (function (_super) {\r\n    tslib_1.__extends(TowerRepair, _super);\r\n    function TowerRepair(taskInfo) {\r\n        return _super.call(this, taskInfo) || this;\r\n    }\r\n    TowerRepair.prototype.doWork = function () {\r\n        var info = this.taskInfo;\r\n        var site = Game.getObjectById(info.targetID);\r\n        // if(site.structureType == \"rampart\")  console.log(\"got a rampart!\");\r\n        var tower = Game.getObjectById(info.assignedTo);\r\n        //console.log(\"Tower: \" + tower.structureType + \" \" + tower.owner)\r\n        if (tower == null || site == null) {\r\n            console.log(\"something went wrong\");\r\n        }\r\n        if (site.hits == site.hitsMax || tower.energy < tower.energyCapacity * .5) {\r\n            this.taskInfo.finished = true;\r\n            return;\r\n        }\r\n        tower.repair(site);\r\n    };\r\n    TowerRepair.addTask = function (roomName) {\r\n        var room = Game.rooms[roomName];\r\n        var targets = room.find(FIND_STRUCTURES)\r\n            .filter(function (structure) { return structure.hits < structure.hitsMax * .75 && structure.hits < TowerRepairTaskInfo.maxHitPoints; })\r\n            .sort(function (a, b) { return a.hits - b.hits; });\r\n        for (var id in targets) {\r\n            var thing = targets[id];\r\n            //if(thing.structureType == \"rampart\") console.log(\"found 1\");\r\n            var taskInfo = new TowerRepairTaskInfo(roomName, thing.id);\r\n            var existingTaskCount = StructureTaskQueue.totalCount(roomName, taskInfo.name);\r\n            if (existingTaskCount < taskInfo.maxConcurrentCount) {\r\n                StructureTaskQueue.addPending(taskInfo, roomName);\r\n            }\r\n        }\r\n    };\r\n    return TowerRepair;\r\n}(StructureTask));\r\nexport { TowerRepair };\r\n//# sourceMappingURL=TowerRepairTask.js.map","map":{"version":3,"file":"TowerRepairTask.js","sourceRoot":"","sources":["../../src/tasks/structure/TowerRepairTask.ts"],"names":[],"mappings":"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"}}
