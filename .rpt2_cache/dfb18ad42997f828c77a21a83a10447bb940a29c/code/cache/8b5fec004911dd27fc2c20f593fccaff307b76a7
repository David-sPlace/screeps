{"code":"import * as utils from \"utils/utils\";\r\nimport { Restock } from \"tasks/creep/RestockTask\";\r\nimport { Build } from \"tasks/creep/Build\";\r\nimport { Upgrade } from \"tasks/creep/UpgradeTask\";\r\nimport { WorkerTaskQueue, StructureTaskQueue } from \"utils/TaskQueue\";\r\nimport { RepairTask } from \"tasks/creep/RepairTask\";\r\nimport { FillTower } from \"tasks/creep/FillTowerTask\";\r\nimport { TowerRepair, TowerAttack } from \"tasks/structure/TowerRepairTask\";\r\nvar TaskManager = /** @class */ (function () {\r\n    function TaskManager() {\r\n    }\r\n    TaskManager.processRoomTasks = function (roomName) {\r\n        this.addBuildingTasks(roomName);\r\n        this.addWorkerTasks(roomName);\r\n        this.activateTasks(roomName);\r\n    };\r\n    TaskManager.activateTasks = function (roomName) {\r\n        var idleCreeps = utils.findIdleCreeps(roomName);\r\n        for (var id in idleCreeps) {\r\n            var creep = idleCreeps[id];\r\n            if (creep != undefined) {\r\n                var mem = creep.memory;\r\n                if (mem.idle) {\r\n                    WorkerTaskQueue.start(creep.name, roomName);\r\n                }\r\n            }\r\n        }\r\n        var stillIdleCreeps = utils.findIdleCreeps(roomName);\r\n        for (var id in stillIdleCreeps) {\r\n            var creep = stillIdleCreeps[id];\r\n            var m = creep.memory;\r\n            creep.moveTo(Game.getObjectById(m.spawnID));\r\n        }\r\n        var activeWorkerTasks = WorkerTaskQueue.allActive(roomName);\r\n        for (var assignedName in activeWorkerTasks) {\r\n            var creep = Game.creeps[assignedName];\r\n            var taskInfo = activeWorkerTasks[assignedName];\r\n            if (taskInfo.assignedTo != assignedName) {\r\n                taskInfo.assignedTo = assignedName;\r\n            }\r\n            if (taskInfo.name == \"Restock\")\r\n                this.processTask(new Restock(taskInfo), roomName);\r\n            else if (taskInfo.name == \"Upgrade\")\r\n                this.processTask(new Upgrade(taskInfo), roomName);\r\n            else if (taskInfo.name == \"Build\")\r\n                this.processTask(new Build(taskInfo), roomName);\r\n            else if (taskInfo.name == \"Repair\")\r\n                this.processTask(new RepairTask(taskInfo), roomName);\r\n            else if (taskInfo.name == \"FillTower\")\r\n                this.processTask(new FillTower(taskInfo), roomName);\r\n        }\r\n        var idleStructures = utils.findIdleSmartStructures(roomName);\r\n        for (var id in idleStructures) {\r\n            // console.log(\"structure found! \" + id)\r\n            var structure = idleStructures[id];\r\n            if (structure != undefined) {\r\n                var memory = structure.memory;\r\n                if (memory.idle) {\r\n                    StructureTaskQueue.startTask(structure.id, roomName);\r\n                }\r\n            }\r\n        }\r\n        var activeStructureTasks = StructureTaskQueue.allActive(roomName);\r\n        for (var buildingID in activeStructureTasks) {\r\n            var structure = Game.getObjectById(buildingID);\r\n            var structureTaskInfo = activeStructureTasks[buildingID];\r\n            if (structureTaskInfo.assignedTo != buildingID) {\r\n                structureTaskInfo.assignedTo = buildingID;\r\n            }\r\n            if (structureTaskInfo.name == \"TowerRepair\")\r\n                this.processTask(new TowerRepair(structureTaskInfo), roomName);\r\n            if (structureTaskInfo.name == \"TowerAttack\")\r\n                this.processTask(new TowerAttack(structureTaskInfo), roomName);\r\n        }\r\n    };\r\n    TaskManager.processTask = function (task, roomName) {\r\n        if (!task.taskInfo.started) {\r\n            task.start();\r\n        }\r\n        if (task.taskInfo.finished) {\r\n            task.finish();\r\n            WorkerTaskQueue.finish(task.taskInfo.assignedTo, roomName);\r\n        }\r\n        if (task.taskInfo.started) {\r\n            task.continue();\r\n            if (task.taskInfo.finished) {\r\n                task.finish();\r\n                WorkerTaskQueue.finish(task.taskInfo.assignedTo, roomName);\r\n            }\r\n        }\r\n    };\r\n    TaskManager.addBuildingTasks = function (roomName) {\r\n        TowerAttack.addTask(roomName);\r\n        TowerRepair.addTask(roomName);\r\n    };\r\n    TaskManager.addWorkerTasks = function (roomName) {\r\n        Restock.addRestockTasks(roomName);\r\n        FillTower.addRepairTask(roomName);\r\n        Build.addBuildTasks(roomName);\r\n        Upgrade.addUpgradeTasks(roomName);\r\n    };\r\n    return TaskManager;\r\n}());\r\nexport { TaskManager };\r\n//# sourceMappingURL=taskManager.js.map","map":{"version":3,"file":"taskManager.js","sourceRoot":"","sources":["src/taskManager.ts"],"names":[],"mappings":"AACA,OAAO,KAAK,KAAK,MAAM,aAAa,CAAC;AAErC,OAAO,EAAE,OAAO,EAAE,MAAM,yBAAyB,CAAC;AAClD,OAAO,EAAE,KAAK,EAAE,MAAM,mBAAmB,CAAC;AAC1C,OAAO,EAAE,OAAO,EAAE,MAAM,yBAAyB,CAAC;AAClD,OAAO,EAAE,eAAe,EAAE,kBAAkB,EAAE,MAAM,iBAAiB,CAAC;AAEtE,OAAO,EAAE,UAAU,EAAE,MAAM,wBAAwB,CAAC;AACpD,OAAO,EAAE,SAAS,EAAE,MAAM,2BAA2B,CAAC;AACtD,OAAO,EAAE,WAAW,EAAE,WAAW,EAAE,MAAM,iCAAiC,CAAC;AAE3E;IAAA;IA4HA,CAAC;IA1HO,4BAAgB,GAAvB,UAAwB,QAAgB;QAEvC,IAAI,CAAC,gBAAgB,CAAC,QAAQ,CAAC,CAAC;QAChC,IAAI,CAAC,cAAc,CAAC,QAAQ,CAAC,CAAC;QAC9B,IAAI,CAAC,aAAa,CAAC,QAAQ,CAAC,CAAC;IAC9B,CAAC;IACc,yBAAa,GAA5B,UAA6B,QAAgB;QAE5C,IAAI,UAAU,GAAG,KAAK,CAAC,cAAc,CAAC,QAAQ,CAAC,CAAC;QAChD,KAAK,IAAI,EAAE,IAAI,UAAU,EACzB;YACC,IAAI,KAAK,GAAG,UAAU,CAAC,EAAE,CAAU,CAAC;YACpC,IAAI,KAAK,IAAI,SAAS,EACtB;gBACC,IAAI,GAAG,GAAG,KAAK,CAAC,MAAqB,CAAC;gBACtC,IAAI,GAAG,CAAC,IAAI,EACZ;oBACC,eAAe,CAAC,KAAK,CAAC,KAAK,CAAC,IAAI,EAAE,QAAQ,CAAC,CAAA;iBAC3C;aACD;SACD;QAED,IAAI,eAAe,GAAG,KAAK,CAAC,cAAc,CAAC,QAAQ,CAAC,CAAC;QACrD,KAAK,IAAI,EAAE,IAAI,eAAe,EAC9B;YACC,IAAI,KAAK,GAAG,eAAe,CAAC,EAAE,CAAC,CAAC;YAChC,IAAI,CAAC,GAAG,KAAK,CAAC,MAAqB,CAAA;YACnC,KAAK,CAAC,MAAM,CAAC,IAAI,CAAC,aAAa,CAAC,CAAC,CAAC,OAAO,CAAmB,CAAC,CAAA;SAC7D;QAED,IAAI,iBAAiB,GAAG,eAAe,CAAC,SAAS,CAAC,QAAQ,CAAC,CAAC;QAC5D,KAAK,IAAI,YAAY,IAAI,iBAAiB,EAC1C;YACC,IAAI,KAAK,GAAG,IAAI,CAAC,MAAM,CAAC,YAAY,CAAC,CAAC;YACtC,IAAI,QAAQ,GAAG,iBAAiB,CAAC,YAAY,CAAC,CAAC;YAC/C,IAAI,QAAQ,CAAC,UAAU,IAAI,YAAY,EACvC;gBACC,QAAQ,CAAC,UAAU,GAAG,YAAY,CAAC;aACnC;YAED,IAAI,QAAQ,CAAC,IAAI,IAAI,SAAS;gBAC7B,IAAI,CAAC,WAAW,CAAC,IAAI,OAAO,CAAC,QAAQ,CAAC,EAAE,QAAQ,CAAC,CAAC;iBAE9C,IAAI,QAAQ,CAAC,IAAI,IAAI,SAAS;gBAClC,IAAI,CAAC,WAAW,CAAC,IAAI,OAAO,CAAC,QAAQ,CAAC,EAAE,QAAQ,CAAC,CAAC;iBAC9C,IAAI,QAAQ,CAAC,IAAI,IAAI,OAAO;gBAChC,IAAI,CAAC,WAAW,CAAC,IAAI,KAAK,CAAC,QAAQ,CAAC,EAAE,QAAQ,CAAC,CAAC;iBAC5C,IAAI,QAAQ,CAAC,IAAI,IAAI,QAAQ;gBACjC,IAAI,CAAC,WAAW,CAAC,IAAI,UAAU,CAAC,QAAQ,CAAC,EAAE,QAAQ,CAAC,CAAC;iBACjD,IAAI,QAAQ,CAAC,IAAI,IAAI,WAAW;gBACpC,IAAI,CAAC,WAAW,CAAC,IAAI,SAAS,CAAC,QAAQ,CAAC,EAAE,QAAQ,CAAC,CAAC;SAErD;QAED,IAAI,cAAc,GAAG,KAAK,CAAC,uBAAuB,CAAC,QAAQ,CAAC,CAAC;QAC7D,KAAK,IAAI,EAAE,IAAI,cAAc,EAC7B;YACC,wCAAwC;YACxC,IAAI,SAAS,GAAG,cAAc,CAAC,EAAE,CAAmB,CAAC;YACrD,IAAI,SAAS,IAAI,SAAS,EAC1B;gBACC,IAAI,MAAM,GAAG,SAAS,CAAC,MAAyB,CAAC;gBACjD,IAAI,MAAM,CAAC,IAAI,EACf;oBACC,kBAAkB,CAAC,SAAS,CAAC,SAAS,CAAC,EAAE,EAAE,QAAQ,CAAC,CAAC;iBACrD;aACD;SACD;QAED,IAAI,oBAAoB,GAAG,kBAAkB,CAAC,SAAS,CAAC,QAAQ,CAAC,CAAC;QAClE,KAAK,IAAI,UAAU,IAAI,oBAAoB,EAC3C;YACC,IAAI,SAAS,GAAG,IAAI,CAAC,aAAa,CAAC,UAAU,CAAmB,CAAC;YACjE,IAAI,iBAAiB,GAAG,oBAAoB,CAAC,UAAU,CAAC,CAAC;YACzD,IAAI,iBAAiB,CAAC,UAAU,IAAI,UAAU,EAC9C;gBACC,iBAAiB,CAAC,UAAU,GAAG,UAAU,CAAC;aAC1C;YACD,IAAI,iBAAiB,CAAC,IAAI,IAAI,aAAa;gBAC1C,IAAI,CAAC,WAAW,CAAC,IAAI,WAAW,CAAC,iBAAiB,CAAC,EAAE,QAAQ,CAAC,CAAC;YAChE,IAAI,iBAAiB,CAAC,IAAI,IAAI,aAAa;gBAC1C,IAAI,CAAC,WAAW,CAAC,IAAI,WAAW,CAAC,iBAAiB,CAAC,EAAE,QAAQ,CAAC,CAAC;SAEhE;IAEF,CAAC;IACc,uBAAW,GAA1B,UAA2B,IAAW,EAAE,QAAgB;QAEvD,IAAI,CAAC,IAAI,CAAC,QAAQ,CAAC,OAAO,EAC1B;YACC,IAAI,CAAC,KAAK,EAAE,CAAC;SACb;QACD,IAAI,IAAI,CAAC,QAAQ,CAAC,QAAQ,EAC1B;YACC,IAAI,CAAC,MAAM,EAAE,CAAC;YACd,eAAe,CAAC,MAAM,CAAC,IAAI,CAAC,QAAQ,CAAC,UAAU,EAAE,QAAQ,CAAC,CAAC;SAC3D;QACD,IAAI,IAAI,CAAC,QAAQ,CAAC,OAAO,EACzB;YACC,IAAI,CAAC,QAAQ,EAAE,CAAC;YAChB,IAAI,IAAI,CAAC,QAAQ,CAAC,QAAQ,EAC1B;gBACC,IAAI,CAAC,MAAM,EAAE,CAAC;gBACd,eAAe,CAAC,MAAM,CAAC,IAAI,CAAC,QAAQ,CAAC,UAAU,EAAE,QAAQ,CAAC,CAAC;aAC3D;SACD;IAEF,CAAC;IAEc,4BAAgB,GAA/B,UAAgC,QAAgB;QAE/C,WAAW,CAAC,OAAO,CAAC,QAAQ,CAAC,CAAC;QAC9B,WAAW,CAAC,OAAO,CAAC,QAAQ,CAAC,CAAC;IAC/B,CAAC;IACc,0BAAc,GAA7B,UAA8B,QAAgB;QAE7C,OAAO,CAAC,eAAe,CAAC,QAAQ,CAAC,CAAC;QAClC,SAAS,CAAC,aAAa,CAAC,QAAQ,CAAC,CAAC;QAClC,KAAK,CAAC,aAAa,CAAC,QAAQ,CAAC,CAAC;QAC9B,OAAO,CAAC,eAAe,CAAC,QAAQ,CAAC,CAAC;IACnC,CAAC;IAEF,kBAAC;AAAD,CAAC,AA5HD,IA4HC"}}
