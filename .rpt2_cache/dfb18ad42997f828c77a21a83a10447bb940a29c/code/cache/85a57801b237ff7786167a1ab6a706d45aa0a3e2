{"code":"import * as tslib_1 from \"tslib\";\r\nimport { WorkerTask, WorkerTaskInfo } from \"abstract/workerTask\";\r\nimport { WorkerTaskQueue } from \"utils/TaskQueue\";\r\nvar FillTowerTaskInfo = /** @class */ (function (_super) {\r\n    tslib_1.__extends(FillTowerTaskInfo, _super);\r\n    function FillTowerTaskInfo(roomName, controllerID) {\r\n        var _this = _super.call(this, roomName, \"\\uD83D\\uDC31\\u200D\\uD83D\\uDC09\", controllerID) || this;\r\n        _this.name = \"FillTower\";\r\n        _this.maxConcurrentCount = 2;\r\n        _this.towerID = controllerID;\r\n        return _this;\r\n    }\r\n    return FillTowerTaskInfo;\r\n}(WorkerTaskInfo));\r\nexport { FillTowerTaskInfo };\r\nvar FillTower = /** @class */ (function (_super) {\r\n    tslib_1.__extends(FillTower, _super);\r\n    //taskInfo: WorkerTaskInfo;\r\n    function FillTower(taskInfo) {\r\n        return _super.call(this, taskInfo) || this;\r\n        //this.taskInfo = taskInfo;\r\n    }\r\n    FillTower.prototype.doWork = function () {\r\n        var info = this.taskInfo;\r\n        var tower = Game.getObjectById(info.towerID);\r\n        var creep = Game.creeps[this.taskInfo.assignedTo];\r\n        if (creep.transfer(tower, RESOURCE_ENERGY) == ERR_NOT_IN_RANGE && creep.carry.energy > 0) {\r\n            creep.moveTo(tower, { visualizePathStyle: { stroke: '#ffffff' } });\r\n        }\r\n        else if (creep.carry.energy == 0 || tower.energy == tower.energyCapacity) {\r\n            this.taskInfo.finished = true;\r\n            return;\r\n        }\r\n    };\r\n    FillTower.addRepairTask = function (roomName) {\r\n        var room = Game.rooms[roomName];\r\n        var towers = room.find(FIND_MY_STRUCTURES).filter(function (t) { return t.structureType == \"tower\" && t.energy < t.energyCapacity; });\r\n        //var mem = room.memory as RoomMemory;\r\n        //mem.test = towers;\r\n        //console.log(\"tower targets: \" + towers.length)\r\n        towers.sort(function (a, b) { return a.energy - b.energy; });\r\n        for (var id in towers) {\r\n            var thing = towers[id];\r\n            var taskInfo = new FillTowerTaskInfo(roomName, thing.id);\r\n            var existingTaskCount = WorkerTaskQueue.totalCount(roomName, taskInfo.name);\r\n            if (existingTaskCount < taskInfo.maxConcurrentCount) {\r\n                //console.log(\"Adding tower fill task\")\r\n                WorkerTaskQueue.addPending(taskInfo, roomName);\r\n            }\r\n        }\r\n    };\r\n    return FillTower;\r\n}(WorkerTask));\r\nexport { FillTower };\r\n//# sourceMappingURL=FillTowerTask.js.map","map":{"version":3,"file":"FillTowerTask.js","sourceRoot":"","sources":["../../src/tasks/creep/FillTowerTask.ts"],"names":[],"mappings":";AAAA,OAAO,EAAE,UAAU,EAAE,cAAc,EAAE,MAAM,qBAAqB,CAAC;AACjE,OAAO,EAAE,eAAe,EAAE,MAAM,iBAAiB,CAAC;AAGlD;IAAuC,6CAAc;IAKpD,2BAAY,QAAgB,EAAE,YAAoB;QAAlD,YACC,kBAAM,QAAQ,EAAC,gCAAO,EAAE,YAAY,CAAC,SAErC;QAND,UAAI,GAAG,WAAW,CAAC;QACnB,wBAAkB,GAAG,CAAC,CAAC;QAItB,KAAI,CAAC,OAAO,GAAG,YAAY,CAAC;;IAC7B,CAAC;IACF,wBAAC;AAAD,CAAC,AATD,CAAuC,cAAc,GASpD;;AAID;IAA+B,qCAAU;IAExC,2BAA2B;IAC3B,mBAAY,QAAwB;eACnC,kBAAM,QAAQ,CAAC;QACf,2BAA2B;IAC5B,CAAC;IACD,0BAAM,GAAN;QAEC,IAAI,IAAI,GAAG,IAAI,CAAC,QAA6B,CAAC;QAC9C,IAAI,KAAK,GAAG,IAAI,CAAC,aAAa,CAAC,IAAI,CAAC,OAAO,CAAmB,CAAC;QAC/D,IAAI,KAAK,GAAG,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,QAAQ,CAAC,UAAU,CAAU,CAAC;QAE3D,IAAI,KAAK,CAAC,QAAQ,CAAC,KAAK,EAAE,eAAe,CAAC,IAAI,gBAAgB,IAAI,KAAK,CAAC,KAAK,CAAC,MAAM,GAAG,CAAC,EACxF;YACC,KAAK,CAAC,MAAM,CAAC,KAAK,EAAE,EAAE,kBAAkB,EAAE,EAAE,MAAM,EAAE,SAAS,EAAE,EAAE,CAAC,CAAC;SACnE;aACI,IAAG,KAAK,CAAC,KAAK,CAAC,MAAM,IAAI,CAAC,IAAI,KAAK,CAAC,MAAM,IAAI,KAAK,CAAC,cAAc,EACvE;YACC,IAAI,CAAC,QAAQ,CAAC,QAAQ,GAAG,IAAI,CAAC;YAC9B,OAAO;SACP;IAEF,CAAC;IACM,uBAAa,GAApB,UAAqB,QAAgB;QAEpC,IAAI,IAAI,GAAG,IAAI,CAAC,KAAK,CAAC,QAAQ,CAAC,CAAC;QAChC,IAAM,MAAM,GAAG,IAAI,CAAC,IAAI,CAAC,kBAAkB,CAAC,CAAC,MAAM,CAAC,UAAA,CAAC,IAAE,OAAA,CAAC,CAAC,aAAa,IAAE,OAAO,IAAI,CAAC,CAAC,MAAM,GAAG,CAAC,CAAC,cAAc,EAAvD,CAAuD,CAAqB,CAAC;QACpI,sCAAsC;QACtC,oBAAoB;QACpB,gDAAgD;QAChD,MAAM,CAAC,IAAI,CAAC,UAAC,CAAC,EAAE,CAAC,IAAK,OAAA,CAAC,CAAC,MAAM,GAAG,CAAC,CAAC,MAAM,EAAnB,CAAmB,CAAC,CAAC;QAE3C,KAAK,IAAM,EAAE,IAAI,MAAM,EACvB;YACC,IAAI,KAAK,GAAG,MAAM,CAAC,EAAE,CAAmB,CAAC;YACzC,IAAI,QAAQ,GAAG,IAAI,iBAAiB,CAAC,QAAQ,EAAE,KAAK,CAAC,EAAE,CAAC,CAAC;YACzD,IAAI,iBAAiB,GAAG,eAAe,CAAC,UAAU,CAAC,QAAQ,EAAE,QAAQ,CAAC,IAAI,CAAC,CAAC;YAC5E,IAAI,iBAAiB,GAAG,QAAQ,CAAC,kBAAkB,EACnD;gBACC,uCAAuC;gBACvC,eAAe,CAAC,UAAU,CAAC,QAAQ,EAAE,QAAQ,CAAC,CAAC;aAC/C;SACD;IAEF,CAAC;IACF,gBAAC;AAAD,CAAC,AA9CD,CAA+B,UAAU,GA8CxC"}}
