{"code":"import * as tslib_1 from \"tslib\";\r\nimport { WorkerTask, WorkerTaskInfo } from \"abstract/WorkerTask\";\r\nimport { WorkerTaskQueue } from \"utils/TaskQueue\";\r\nimport * as utils from \"utils/utils\";\r\nvar RestockTaskInfo = /** @class */ (function (_super) {\r\n    tslib_1.__extends(RestockTaskInfo, _super);\r\n    function RestockTaskInfo(roomName, restockID) {\r\n        var _this = _super.call(this, roomName, \"\\uD83D\\uDED2\") || this;\r\n        _this.name = \"Restock\";\r\n        _this.maxConcurrentCount = 10;\r\n        _this.restockTargetID = restockID;\r\n        return _this;\r\n    }\r\n    return RestockTaskInfo;\r\n}(WorkerTaskInfo));\r\nexport { RestockTaskInfo };\r\nvar RestockTask = /** @class */ (function (_super) {\r\n    tslib_1.__extends(RestockTask, _super);\r\n    function RestockTask(taskInfo) {\r\n        return _super.call(this, taskInfo) || this;\r\n    }\r\n    RestockTask.addRestockTasks = function (roomName) {\r\n        var restockables = utils.getRestockables(roomName);\r\n        for (var targetID in restockables) {\r\n            var restockable = restockables[targetID];\r\n            var taskInfo = new RestockTaskInfo(roomName, restockable.id);\r\n            var existingTaskCount = WorkerTaskQueue.totalCount(roomName, taskInfo.name);\r\n            var maxConcurrentCount = taskInfo.maxConcurrentCount;\r\n            if (existingTaskCount < maxConcurrentCount) {\r\n                if (taskInfo == undefined) {\r\n                    console.log(\"Restock task was undefined!!\");\r\n                }\r\n                WorkerTaskQueue.addPending(taskInfo, roomName);\r\n            }\r\n        }\r\n    };\r\n    RestockTask.prototype.doWork = function () {\r\n        var creep = Game.creeps[this.taskInfo.assignedTo];\r\n        var targets = creep.room.find(FIND_STRUCTURES, {\r\n            filter: function (structure) {\r\n                return (structure.structureType == STRUCTURE_EXTENSION || structure.structureType == STRUCTURE_SPAWN) &&\r\n                    structure.energy < structure.energyCapacity;\r\n            }\r\n        }).sort(function (structureA, structureB) { return creep.pos.getRangeTo(structureA) - creep.pos.getRangeTo(structureB); });\r\n        if (creep.carry.energy == 0 || targets.length == 0) {\r\n            this.taskInfo.finished = true;\r\n            return;\r\n        }\r\n        if (creep.transfer(targets[0], RESOURCE_ENERGY) == ERR_NOT_IN_RANGE) {\r\n            creep.moveTo(targets[0], { visualizePathStyle: { stroke: '#ffffff' } });\r\n        }\r\n    };\r\n    return RestockTask;\r\n}(WorkerTask));\r\nexport { RestockTask };\r\n//# sourceMappingURL=RestockTask.js.map","map":{"version":3,"file":"RestockTask.js","sourceRoot":"","sources":["../src/tasks/RestockTask.ts"],"names":[],"mappings":";AAAA,OAAO,EAAE,UAAU,EAAE,cAAc,EAAE,MAAM,qBAAqB,CAAC;AACjE,OAAO,EAAE,eAAe,EAAE,MAAM,iBAAiB,CAAC;AAClD,OAAO,KAAK,KAAK,MAAM,aAAa,CAAA;AACpC;IAAqC,2CAAc;IAKlD,yBAAY,QAAgB,EAAE,SAAiB;QAA/C,YAEC,kBAAM,QAAQ,EAAE,cAAI,CAAC,SAErB;QAPD,UAAI,GAAG,SAAS,CAAC;QACjB,wBAAkB,GAAG,EAAE,CAAC;QAKvB,KAAI,CAAC,eAAe,GAAG,SAAS,CAAC;;IAClC,CAAC;IACF,sBAAC;AAAD,CAAC,AAVD,CAAqC,cAAc,GAUlD;;AACD;IAAiC,uCAAU;IAG1C,qBAAY,QAAwB;eAEnC,kBAAM,QAAQ,CAAC;IAChB,CAAC;IACM,2BAAe,GAAtB,UAAuB,QAAgB;QAEtC,IAAI,YAAY,GAAG,KAAK,CAAC,eAAe,CAAC,QAAQ,CAAC,CAAA;QAElD,KAAK,IAAM,QAAQ,IAAI,YAAY,EACnC;YACC,IAAI,WAAW,GAAG,YAAY,CAAC,QAAQ,CAAC,CAAC;YACzC,IAAI,QAAQ,GAAG,IAAI,eAAe,CAAC,QAAQ,EAAE,WAAW,CAAC,EAAE,CAAC,CAAC;YAC7D,IAAI,iBAAiB,GAAG,eAAe,CAAC,UAAU,CAAC,QAAQ,EAAE,QAAQ,CAAC,IAAI,CAAC,CAAC;YAC5E,IAAI,kBAAkB,GAAG,QAAQ,CAAC,kBAAkB,CAAC;YAErD,IAAI,iBAAiB,GAAG,kBAAkB,EAC1C;gBACC,IAAI,QAAQ,IAAI,SAAS,EACzB;oBACC,OAAO,CAAC,GAAG,CAAC,8BAA8B,CAAC,CAAC;iBAC5C;gBACD,eAAe,CAAC,UAAU,CAAC,QAAQ,EAAE,QAAQ,CAAC,CAAA;aAC9C;SACD;IACF,CAAC;IACD,4BAAM,GAAN;QAEC,IAAI,KAAK,GAAG,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,QAAQ,CAAC,UAAU,CAAU,CAAC;QAC3D,IAAI,OAAO,GAAG,KAAK,CAAC,IAAI,CAAC,IAAI,CAAC,eAAe,EAAE;YAC9C,MAAM,EAAE,UAAC,SAAS;gBAEjB,OAAO,CAAC,SAAS,CAAC,aAAa,IAAI,mBAAmB,IAAI,SAAS,CAAC,aAAa,IAAI,eAAe,CAAC;oBACpG,SAAS,CAAC,MAAM,GAAG,SAAS,CAAC,cAAc,CAAC;YAC9C,CAAC;SACD,CAAC,CAAC,IAAI,CAAC,UAAC,UAAU,EAAE,UAAU,IAAI,OAAA,KAAK,CAAC,GAAG,CAAC,UAAU,CAAC,UAAU,CAAC,GAAG,KAAK,CAAC,GAAG,CAAC,UAAU,CAAC,UAAU,CAAC,EAAnE,CAAmE,CAAC,CAAC;QACxG,IAAI,KAAK,CAAC,KAAK,CAAC,MAAM,IAAI,CAAC,IAAI,OAAO,CAAC,MAAM,IAAI,CAAC,EAClD;YACC,IAAI,CAAC,QAAQ,CAAC,QAAQ,GAAG,IAAI,CAAC;YAC9B,OAAO;SACP;QACD,IAAI,KAAK,CAAC,QAAQ,CAAC,OAAO,CAAC,CAAC,CAAC,EAAE,eAAe,CAAC,IAAI,gBAAgB,EACnE;YACC,KAAK,CAAC,MAAM,CAAC,OAAO,CAAC,CAAC,CAAC,EAAE,EAAE,kBAAkB,EAAE,EAAE,MAAM,EAAE,SAAS,EAAE,EAAE,CAAC,CAAC;SACxE;IAEF,CAAC;IACF,kBAAC;AAAD,CAAC,AAjDD,CAAiC,UAAU,GAiD1C"}}
