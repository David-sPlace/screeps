{"code":"import * as tslib_1 from \"tslib\";\r\nimport { CreepTask } from \"tasks/CreepTask\";\r\nimport { CreepTaskRequest } from \"tasks/CreepTaskRequest\";\r\nimport { CreepTaskQueue } from \"../CreepTaskQueue\";\r\nimport { RoomManager } from \"RoomManager\";\r\nimport { TaskState } from \"tasks/Task\";\r\nvar UpgradeRequest = /** @class */ (function (_super) {\r\n    tslib_1.__extends(UpgradeRequest, _super);\r\n    function UpgradeRequest(roomName, controllerID) {\r\n        var _this = _super.call(this, roomName, \"\\uD83C\\uDF87\", controllerID) || this;\r\n        _this.requiredRole = 4 /* ROLE_UPGRADER */;\r\n        _this.priority = 1;\r\n        _this.name = \"Upgrade\";\r\n        _this.maxConcurrentCount = RoomManager.maxUpgradersPerRoom;\r\n        return _this;\r\n    }\r\n    return UpgradeRequest;\r\n}(CreepTaskRequest));\r\nexport { UpgradeRequest };\r\nvar Upgrade = /** @class */ (function (_super) {\r\n    tslib_1.__extends(Upgrade, _super);\r\n    function Upgrade(taskInfo) {\r\n        return _super.call(this, taskInfo) || this;\r\n    }\r\n    Upgrade.prototype.init = function () {\r\n        _super.prototype.init.call(this);\r\n        this.request.status = TaskState.START;\r\n    };\r\n    Upgrade.prototype.start = function () {\r\n        _super.prototype.start.call(this);\r\n        var creep = Game.creeps[this.request.assignedTo];\r\n        if (creep.carry.energy > 0)\r\n            this.request.status = TaskState.IN_PROGRESS;\r\n        else\r\n            this.request.status = TaskState.PREP;\r\n    };\r\n    Upgrade.prototype.prep = function () {\r\n        _super.prototype.prep.call(this);\r\n        if (this.request.status == TaskState.FINISHED)\r\n            return;\r\n        var creep = Game.creeps[this.request.assignedTo];\r\n        this.collectFromContainer(this.request.roomName, creep.id);\r\n        if (creep.carry.energy == creep.carryCapacity) {\r\n            this.request.status = TaskState.IN_PROGRESS;\r\n        }\r\n    };\r\n    Upgrade.prototype.continue = function () {\r\n        _super.prototype.continue.call(this);\r\n        if (this.request.status == TaskState.FINISHED)\r\n            return;\r\n        var creep = Game.creeps[this.request.assignedTo];\r\n        var info = this.request;\r\n        var controller = Game.getObjectById(info.targetID);\r\n        if (creep.upgradeController(controller) == ERR_NOT_IN_RANGE) {\r\n            creep.moveTo(controller, { visualizePathStyle: { stroke: '#ffffff' } });\r\n        }\r\n        if (creep.carry.energy == 0) {\r\n            this.request.status = TaskState.PREP;\r\n        }\r\n    };\r\n    Upgrade.addRequests = function (roomName) {\r\n        var controller = Game.rooms[roomName].controller;\r\n        var request = new UpgradeRequest(roomName, controller.id);\r\n        var tasksNeeded = request.maxConcurrentCount - CreepTaskQueue.totalCount(roomName, request.name);\r\n        for (var i = 0; i < tasksNeeded; i++) {\r\n            CreepTaskQueue.addPending(request);\r\n        }\r\n    };\r\n    return Upgrade;\r\n}(CreepTask));\r\nexport { Upgrade };\r\n//# sourceMappingURL=Upgrade.js.map","map":{"version":3,"file":"Upgrade.js","sourceRoot":"","sources":["../../src/tasks/creep/Upgrade.ts"],"names":[],"mappings":"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"}}
