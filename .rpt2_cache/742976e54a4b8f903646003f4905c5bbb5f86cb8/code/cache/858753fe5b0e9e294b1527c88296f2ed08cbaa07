{"code":"import * as tslib_1 from \"tslib\";\r\nimport { StructureTaskRequest } from \"tasks/StructureTaskRequest\";\r\nimport { StructureTask } from \"tasks/StructureTask\";\r\nimport { StructureTaskQueue } from \"../StructureTaskQueue\";\r\nimport { TaskState } from \"../Task\";\r\nvar TowerAttackTaskInfo = /** @class */ (function (_super) {\r\n    tslib_1.__extends(TowerAttackTaskInfo, _super);\r\n    function TowerAttackTaskInfo(roomName, hostileID) {\r\n        var _this = _super.call(this, roomName, hostileID) || this;\r\n        _this.priority = 0;\r\n        _this.name = \"TowerAttack\";\r\n        _this.maxConcurrentCount = 100;\r\n        return _this;\r\n    }\r\n    return TowerAttackTaskInfo;\r\n}(StructureTaskRequest));\r\nexport { TowerAttackTaskInfo };\r\nvar TowerAttack = /** @class */ (function (_super) {\r\n    tslib_1.__extends(TowerAttack, _super);\r\n    function TowerAttack(taskInfo) {\r\n        var _this = _super.call(this, taskInfo) || this;\r\n        var info = _this.request;\r\n        var hostile = Game.getObjectById(info.targetID);\r\n        // if(site.structureType == \"rampart\")  console.log(\"got a rampart!\");\r\n        var tower = Game.getObjectById(info.assignedTo);\r\n        //console.log(\"Tower: \" + tower.structureType + \" \" + tower.owner)\r\n        if (tower == null || hostile == undefined || hostile.hits == 0) {\r\n            _this.request.status = TaskState.FINISHED;\r\n            return _this;\r\n        }\r\n        tower.attack(hostile);\r\n        return _this;\r\n    }\r\n    TowerAttack.prototype.init = function () {\r\n        this.request.status = TaskState.PREP;\r\n    };\r\n    TowerAttack.prototype.prep = function () {\r\n        this.request.status = TaskState.IN_PROGRESS;\r\n    };\r\n    TowerAttack.prototype.continue = function () {\r\n        _super.prototype.continue.call(this);\r\n    };\r\n    TowerAttack.addTask = function (roomName) {\r\n        var room = Game.rooms[roomName];\r\n        var targets = room.find(FIND_HOSTILE_CREEPS);\r\n        var sorted = targets.sort(function (a, b) { return a.hits - b.hits; });\r\n        for (var id in sorted) {\r\n            var thing = sorted[id];\r\n            var taskInfo = new TowerAttackTaskInfo(roomName, thing.id);\r\n            if (StructureTaskQueue.totalCount(roomName, taskInfo.name) < taskInfo.maxConcurrentCount) {\r\n                StructureTaskQueue.addPending(taskInfo, roomName);\r\n            }\r\n        }\r\n    };\r\n    return TowerAttack;\r\n}(StructureTask));\r\nexport { TowerAttack };\r\n//# sourceMappingURL=TowerAttack.js.map","map":{"version":3,"file":"TowerAttack.js","sourceRoot":"","sources":["../../src/tasks/structure/TowerAttack.ts"],"names":[],"mappings":";AAAA,OAAO,EAAE,oBAAoB,EAAE,MAAM,4BAA4B,CAAC;AAClE,OAAO,EAAE,aAAa,EAAE,MAAM,qBAAqB,CAAC;AACpD,OAAO,EAAE,kBAAkB,EAAE,MAAM,uBAAuB,CAAC;AAC3D,OAAO,EAAE,SAAS,EAAE,MAAM,SAAS,CAAC;AAEpC;IAAyC,+CAAoB;IAI5D,6BAAY,QAAgB,EAAE,SAAiB;QAA/C,YACC,kBAAM,QAAQ,EAAE,SAAS,CAAC,SAC1B;QALD,cAAQ,GAAW,CAAC,CAAA;QACpB,UAAI,GAAW,aAAa,CAAC;QAC7B,wBAAkB,GAAW,GAAG,CAAC;;IAGjC,CAAC;IAEF,0BAAC;AAAD,CAAC,AARD,CAAyC,oBAAoB,GAQ5D;;AACD;IAAiC,uCAAa;IAc7C,qBAAY,QAA8B;QAA1C,YACC,kBAAM,QAAQ,CAAC,SAYf;QAXA,IAAI,IAAI,GAAG,KAAI,CAAC,OAA8B,CAAC;QAC/C,IAAI,OAAO,GAAG,IAAI,CAAC,aAAa,CAAC,IAAI,CAAC,QAAQ,CAAU,CAAC;QACzD,sEAAsE;QACtE,IAAI,KAAK,GAAG,IAAI,CAAC,aAAa,CAAC,IAAI,CAAC,UAAU,CAAmB,CAAC;QAClE,kEAAkE;QAClE,IAAG,KAAK,IAAI,IAAI,IAAI,OAAO,IAAI,SAAS,IAAI,OAAO,CAAC,IAAI,IAAI,CAAC,EAC7D;YACC,KAAI,CAAC,OAAO,CAAC,MAAM,GAAG,SAAS,CAAC,QAAQ,CAAC;;SAEzC;QACD,KAAK,CAAC,MAAM,CAAC,OAAO,CAAC,CAAC;;IACvB,CAAC;IAzBS,0BAAI,GAAd;QAEC,IAAI,CAAC,OAAO,CAAC,MAAM,GAAG,SAAS,CAAC,IAAI,CAAC;IACtC,CAAC;IACS,0BAAI,GAAd;QAGC,IAAI,CAAC,OAAO,CAAC,MAAM,GAAG,SAAS,CAAC,WAAW,CAAA;IAC5C,CAAC;IACS,8BAAQ,GAAlB;QACC,iBAAM,QAAQ,WAAE,CAAC;IAClB,CAAC;IAgBM,mBAAO,GAAd,UAAe,QAAgB;QAC9B,IAAI,IAAI,GAAG,IAAI,CAAC,KAAK,CAAC,QAAQ,CAAC,CAAC;QAChC,IAAM,OAAO,GAAG,IAAI,CAAC,IAAI,CAAC,mBAAmB,CAAC,CAAA;QAE9C,IAAI,MAAM,GAAG,OAAO,CAAC,IAAI,CAAC,UAAC,CAAC,EAAC,CAAC,IAAK,OAAA,CAAC,CAAC,IAAI,GAAG,CAAC,CAAC,IAAI,EAAf,CAAe,CAAC,CAAC;QAEpD,KAAK,IAAM,EAAE,IAAI,MAAM,EACvB;YACC,IAAI,KAAK,GAAG,MAAM,CAAC,EAAE,CAAC,CAAC;YACvB,IAAI,QAAQ,GAAG,IAAI,mBAAmB,CAAC,QAAQ,EAAE,KAAK,CAAC,EAAE,CAAC,CAAC;YAC3D,IAAI,kBAAkB,CAAC,UAAU,CAAC,QAAQ,EAAE,QAAQ,CAAC,IAAI,CAAC,GAAG,QAAQ,CAAC,kBAAkB,EACxF;gBACC,kBAAkB,CAAC,UAAU,CAAC,QAAQ,EAAE,QAAQ,CAAC,CAAC;aAClD;SACD;IACF,CAAC;IACF,kBAAC;AAAD,CAAC,AA7CD,CAAiC,aAAa,GA6C7C"}}
