{"code":"import { Queue } from \"utils/queue\";\r\nvar TaskQueue = /** @class */ (function () {\r\n    function TaskQueue() {\r\n        this._queue = new Queue();\r\n        this._workingTasks = [];\r\n    }\r\n    TaskQueue.prototype.workingCount = function (name) {\r\n        var count = 0;\r\n        for (var value in this._workingTasks) {\r\n            var task = this._workingTasks[value];\r\n            if (task.name == name)\r\n                count++;\r\n        }\r\n        return count;\r\n    };\r\n    TaskQueue.prototype.length = function () {\r\n        return this._queue.length();\r\n    };\r\n    TaskQueue.prototype.addItem = function (queueItem, roomName) {\r\n        if (queueItem == undefined || queueItem == null) {\r\n            console.log(\"tried to add null object to queue - not allowed.\");\r\n            return;\r\n        }\r\n        // if (this._queue.contains(queueItem.name) && queueItem.singular)\r\n        // {\r\n        // \t// console.log(`task already exists and is singular (${queueItem.name}) - skipping.`);\r\n        // \treturn;\r\n        // }\r\n        var total = this._queue.count(queueItem.name) + this.workingCount(queueItem.name);\r\n        if (total >= queueItem.maxConcurrentCount) {\r\n            //console.log(`task already has maximum amount (${queueItem.name}) - skipping.`);\r\n            return;\r\n        }\r\n        console.log(\"Adding new task to queue for room \" + roomName + \": \" + queueItem.name + \", total: \" + total);\r\n        this._queue.push(queueItem);\r\n    };\r\n    TaskQueue.prototype.workingTasks = function () {\r\n        return this._workingTasks;\r\n    };\r\n    TaskQueue.prototype.waitingTasks = function () {\r\n        return this._queue;\r\n    };\r\n    TaskQueue.prototype.startNext = function (creep, data) {\r\n        if (this._queue.any() == false)\r\n            return;\r\n        var task = this._queue.pop();\r\n        if (task != null) {\r\n            console.log(\"starting a task for \" + creep.name);\r\n            task.start(creep, data);\r\n        }\r\n        this._workingTasks.push(task);\r\n    };\r\n    TaskQueue.prototype.finish = function (task) {\r\n        var index = this._workingTasks.indexOf(task);\r\n        if (index > -1) {\r\n            this._workingTasks.splice(index, 1);\r\n        }\r\n    };\r\n    TaskQueue.prototype.any = function () {\r\n        return this._queue.any();\r\n    };\r\n    return TaskQueue;\r\n}());\r\nexport { TaskQueue };\r\n//# sourceMappingURL=taskQueue.js.map","map":{"version":3,"file":"taskQueue.js","sourceRoot":"","sources":["../src/tasks/taskQueue.ts"],"names":[],"mappings":"AACA,OAAO,EAAE,KAAK,EAAE,MAAM,aAAa,CAAC;AAEpC;IAAA;QAES,WAAM,GAAa,IAAI,KAAK,EAAK,CAAC;QAClC,kBAAa,GAAa,EAAE,CAAC;IAqEtC,CAAC;IAnEA,gCAAY,GAAZ,UAAa,IAAY;QACxB,IAAI,KAAK,GAAW,CAAC,CAAC;QACtB,KAAK,IAAM,KAAK,IAAI,IAAI,CAAC,aAAa,EACtC;YACC,IAAI,IAAI,GAAG,IAAI,CAAC,aAAa,CAAC,KAAK,CAAC,CAAC;YACrC,IAAI,IAAI,CAAC,IAAI,IAAI,IAAI;gBAAE,KAAK,EAAE,CAAC;SAC/B;QACD,OAAO,KAAK,CAAC;IACd,CAAC;IACD,0BAAM,GAAN;QAEC,OAAO,IAAI,CAAC,MAAM,CAAC,MAAM,EAAE,CAAC;IAC7B,CAAC;IACD,2BAAO,GAAP,UAAQ,SAAY,EAAE,QAAgB;QAErC,IAAI,SAAS,IAAI,SAAS,IAAI,SAAS,IAAI,IAAI,EAC/C;YACC,OAAO,CAAC,GAAG,CAAC,kDAAkD,CAAC,CAAC;YAChE,OAAO;SACP;QACD,kEAAkE;QAClE,IAAI;QACJ,0FAA0F;QAC1F,WAAW;QACX,IAAI;QACJ,IAAI,KAAK,GAAG,IAAI,CAAC,MAAM,CAAC,KAAK,CAAC,SAAS,CAAC,IAAI,CAAC,GAAG,IAAI,CAAC,YAAY,CAAC,SAAS,CAAC,IAAI,CAAC,CAAC;QAClF,IAAI,KAAK,IAAI,SAAS,CAAC,kBAAkB,EACzC;YACC,iFAAiF;YACjF,OAAO;SACP;QAED,OAAO,CAAC,GAAG,CAAC,uCAAqC,QAAQ,UAAK,SAAS,CAAC,IAAI,iBAAY,KAAO,CAAC,CAAA;QAChG,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,SAAS,CAAC,CAAC;IAC7B,CAAC;IACD,gCAAY,GAAZ;QAEC,OAAO,IAAI,CAAC,aAAa,CAAC;IAC3B,CAAC;IACD,gCAAY,GAAZ;QAEC,OAAO,IAAI,CAAC,MAAM,CAAC;IACpB,CAAC;IACD,6BAAS,GAAT,UAAU,KAAY,EAAE,IAAS;QAEhC,IAAI,IAAI,CAAC,MAAM,CAAC,GAAG,EAAE,IAAI,KAAK;YAAE,OAAO;QACvC,IAAI,IAAI,GAAM,IAAI,CAAC,MAAM,CAAC,GAAG,EAAE,CAAC;QAEhC,IAAI,IAAI,IAAI,IAAI,EAChB;YACC,OAAO,CAAC,GAAG,CAAC,sBAAsB,GAAG,KAAK,CAAC,IAAI,CAAC,CAAC;YACjD,IAAI,CAAC,KAAK,CAAC,KAAK,EAAE,IAAI,CAAC,CAAC;SACxB;QACD,IAAI,CAAC,aAAa,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;IAC/B,CAAC;IACD,0BAAM,GAAN,UAAO,IAAO;QAEb,IAAI,KAAK,GAAG,IAAI,CAAC,aAAa,CAAC,OAAO,CAAC,IAAI,CAAC,CAAC;QAC7C,IAAI,KAAK,GAAG,CAAC,CAAC,EACd;YACC,IAAI,CAAC,aAAa,CAAC,MAAM,CAAC,KAAK,EAAE,CAAC,CAAC,CAAC;SACpC;IACF,CAAC;IACD,uBAAG,GAAH;QAEC,OAAO,IAAI,CAAC,MAAM,CAAC,GAAG,EAAE,CAAC;IAC1B,CAAC;IACF,gBAAC;AAAD,CAAC,AAxED,IAwEC"}}
